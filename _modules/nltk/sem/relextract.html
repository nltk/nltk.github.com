<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>NLTK :: nltk.sem.relextract</title>
  

  <link rel="stylesheet" href="../../../_static/css/nltk_theme.css"/>
  <link rel="stylesheet" href="../../../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="nltk-theme-container">
    <header>
      <div id="logo-container">
          
          <h1>
            <a href="../../../index.html">NLTK</a>
          </h1>
          
      </div>
      <div id="project-container">
        
        <h1>Documentation</h1>
        
      </div>

      <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

      <script type="text/javascript">
        $("#menu-toggle").click(function() {
          $("#menu-toggle").toggleClass("toggled");
          $("#side-menu-container").slideToggle(300);
        });
      </script>
    </header>

    <div id="content-container">

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">
          
  
    
  
  
    <p class="caption" role="heading"><span class="caption-text">NLTK Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/nltk.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">Example Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki">Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki/FAQ">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/issues">Open Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk">NLTK on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Installing NLTK Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contributing to NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../team.html">NLTK Team</a></li>
</ul>

  

        </div>

        
      </div>

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <h1>Source code for nltk.sem.relextract</h1><div class="highlight"><pre>
<span></span><span class="c1"># Natural Language Toolkit: Relation Extraction</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2023 NLTK Project</span>
<span class="c1"># Author: Ewan Klein &lt;ewan@inf.ed.ac.uk&gt;</span>
<span class="c1"># URL: &lt;https://www.nltk.org/&gt;</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Code for extracting relational triples from the ieer and conll2002 corpora.</span>

<span class="sd">Relations are stored internally as dictionaries (&#39;reldicts&#39;).</span>

<span class="sd">The two serialization outputs are &quot;rtuple&quot; and &quot;clause&quot;.</span>

<span class="sd">- An rtuple is a tuple of the form ``(subj, filler, obj)``,</span>
<span class="sd">  where ``subj`` and ``obj`` are pairs of Named Entity mentions, and ``filler`` is the string of words</span>
<span class="sd">  occurring between ``sub`` and ``obj`` (with no intervening NEs). Strings are printed via ``repr()`` to</span>
<span class="sd">  circumvent locale variations in rendering utf-8 encoded strings.</span>
<span class="sd">- A clause is an atom of the form ``relsym(subjsym, objsym)``,</span>
<span class="sd">  where the relation, subject and object have been canonicalized to single strings.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># todo: get a more general solution to canonicalized symbols for clauses -- maybe use xmlcharrefs?</span>

<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="c1"># Dictionary that associates corpora with NE classes</span>
<span class="n">NE_CLASSES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ieer&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;LOCATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PERSON&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DURATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CARDINAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PERCENT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MONEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MEASURE&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;conll2002&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;LOC&quot;</span><span class="p">,</span> <span class="s2">&quot;PER&quot;</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="p">],</span>
    <span class="s2">&quot;ace&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;LOCATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PERSON&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DURATION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CARDINAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PERCENT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MONEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MEASURE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FACILITY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GPE&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Allow abbreviated class labels</span>
<span class="n">short2long</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LOC</span><span class="o">=</span><span class="s2">&quot;LOCATION&quot;</span><span class="p">,</span> <span class="n">ORG</span><span class="o">=</span><span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span> <span class="n">PER</span><span class="o">=</span><span class="s2">&quot;PERSON&quot;</span><span class="p">)</span>
<span class="n">long2short</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LOCATION</span><span class="o">=</span><span class="s2">&quot;LOC&quot;</span><span class="p">,</span> <span class="n">ORGANIZATION</span><span class="o">=</span><span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="n">PERSON</span><span class="o">=</span><span class="s2">&quot;PER&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expand an NE class name.</span>
<span class="sd">    :type type: str</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">short2long</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span>


<div class="viewcode-block" id="class_abbrev"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.class_abbrev">[docs]</a><span class="k">def</span> <span class="nf">class_abbrev</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abbreviate an NE class name.</span>
<span class="sd">    :type type: str</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">long2short</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span></div>


<span class="k">def</span> <span class="nf">_join</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">untag</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join a list into a string, turning tags tuples into tag strings or just words.</span>
<span class="sd">    :param untag: if ``True``, omit the tag from tagged input strings.</span>
<span class="sd">    :type lst: list</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">untag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">nltk.tag</span> <span class="kn">import</span> <span class="n">tuple2str</span>

        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tuple2str</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>


<div class="viewcode-block" id="descape_entity"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.descape_entity">[docs]</a><span class="k">def</span> <span class="nf">descape_entity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">defs</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">entitydefs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate one entity to its ISO Latin value.</span>
<span class="sd">    Inspired by example from effbot.org</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">defs</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># use as is</span></div>


<div class="viewcode-block" id="list2sym"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.list2sym">[docs]</a><span class="k">def</span> <span class="nf">list2sym</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of strings into a canonical symbol.</span>
<span class="sd">    :type lst: list</span>
<span class="sd">    :return: a Unicode string without whitespace</span>
<span class="sd">    :rtype: unicode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">untag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">ENT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&amp;(\w+?);&quot;</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">ENT</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">descape_entity</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sym</span></div>


<div class="viewcode-block" id="tree2semi_rel"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.tree2semi_rel">[docs]</a><span class="k">def</span> <span class="nf">tree2semi_rel</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group a chunk structure into a list of &#39;semi-relations&#39; of the form (list(str), ``Tree``).</span>

<span class="sd">    In order to facilitate the construction of (``Tree``, string, ``Tree``) triples, this</span>
<span class="sd">    identifies pairs whose first member is a list (possibly empty) of terminal</span>
<span class="sd">    strings, and whose second member is a ``Tree`` of the form (NE_label, terminals).</span>

<span class="sd">    :param tree: a chunk tree</span>
<span class="sd">    :return: a list of pairs (list(str), ``Tree``)</span>
<span class="sd">    :rtype: list of tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">nltk.tree</span> <span class="kn">import</span> <span class="n">Tree</span>

    <span class="n">semi_rels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">semi_rel</span> <span class="o">=</span> <span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dtr</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtr</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
            <span class="n">semi_rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dtr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># dtr is a Tree</span>
            <span class="n">semi_rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtr</span>
            <span class="n">semi_rels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">semi_rel</span><span class="p">)</span>
            <span class="n">semi_rel</span> <span class="o">=</span> <span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">semi_rels</span></div>


<div class="viewcode-block" id="semi_rel2reldict"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.semi_rel2reldict">[docs]</a><span class="k">def</span> <span class="nf">semi_rel2reldict</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the pairs generated by ``tree2semi_rel`` into a &#39;reldict&#39;: a dictionary which</span>
<span class="sd">    stores information about the subject and object NEs plus the filler between them.</span>
<span class="sd">    Additionally, a left and right context of length =&lt; window are captured (within</span>
<span class="sd">    a given input sentence).</span>

<span class="sd">    :param pairs: a pair of list(str) and ``Tree``, as generated by</span>
<span class="sd">    :param window: a threshold for the number of items to include in the left and right context</span>
<span class="sd">    :type window: int</span>
<span class="sd">    :return: &#39;relation&#39; dictionaries whose keys are &#39;lcon&#39;, &#39;subjclass&#39;, &#39;subjtext&#39;, &#39;subjsym&#39;, &#39;filler&#39;, objclass&#39;, objtext&#39;, &#39;objsym&#39; and &#39;rcon&#39;</span>
<span class="sd">    :rtype: list(defaultdict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">reldict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;lcon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjclass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjtext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjsym&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2sym</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;filler&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;untagged_filler&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">untag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objclass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objtext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objsym&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2sym</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;rcon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">window</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;untagged_filler&quot;</span><span class="p">],</span>
                    <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjclass&quot;</span><span class="p">],</span>
                    <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objclass&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reldict</span><span class="p">)</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="extract_rels"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.extract_rels">[docs]</a><span class="k">def</span> <span class="nf">extract_rels</span><span class="p">(</span><span class="n">subjclass</span><span class="p">,</span> <span class="n">objclass</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;ace&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter the output of ``semi_rel2reldict`` according to specified NE classes and a filler pattern.</span>

<span class="sd">    The parameters ``subjclass`` and ``objclass`` can be used to restrict the</span>
<span class="sd">    Named Entities to particular types (any of &#39;LOCATION&#39;, &#39;ORGANIZATION&#39;,</span>
<span class="sd">    &#39;PERSON&#39;, &#39;DURATION&#39;, &#39;DATE&#39;, &#39;CARDINAL&#39;, &#39;PERCENT&#39;, &#39;MONEY&#39;, &#39;MEASURE&#39;).</span>

<span class="sd">    :param subjclass: the class of the subject Named Entity.</span>
<span class="sd">    :type subjclass: str</span>
<span class="sd">    :param objclass: the class of the object Named Entity.</span>
<span class="sd">    :type objclass: str</span>
<span class="sd">    :param doc: input document</span>
<span class="sd">    :type doc: ieer document or a list of chunk trees</span>
<span class="sd">    :param corpus: name of the corpus to take as input; possible values are</span>
<span class="sd">        &#39;ieer&#39; and &#39;conll2002&#39;</span>
<span class="sd">    :type corpus: str</span>
<span class="sd">    :param pattern: a regular expression for filtering the fillers of</span>
<span class="sd">        retrieved triples.</span>
<span class="sd">    :type pattern: SRE_Pattern</span>
<span class="sd">    :param window: filters out fillers which exceed this threshold</span>
<span class="sd">    :type window: int</span>
<span class="sd">    :return: see ``mk_reldicts``</span>
<span class="sd">    :rtype: list(defaultdict)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subjclass</span> <span class="ow">and</span> <span class="n">subjclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_expand</span><span class="p">(</span><span class="n">subjclass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
            <span class="n">subjclass</span> <span class="o">=</span> <span class="n">_expand</span><span class="p">(</span><span class="n">subjclass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;your value for the subject type has not been recognized: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="n">subjclass</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">objclass</span> <span class="ow">and</span> <span class="n">objclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_expand</span><span class="p">(</span><span class="n">objclass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
            <span class="n">objclass</span> <span class="o">=</span> <span class="n">_expand</span><span class="p">(</span><span class="n">objclass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;your value for the object type has not been recognized: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">objclass</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s2">&quot;ace&quot;</span> <span class="ow">or</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s2">&quot;conll2002&quot;</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s2">&quot;ieer&quot;</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;corpus type not recognized&quot;</span><span class="p">)</span>

    <span class="n">reldicts</span> <span class="o">=</span> <span class="n">semi_rel2reldict</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>

    <span class="n">relfilter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;subjclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subjclass</span>
        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;filler&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">window</span>
        <span class="ow">and</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;filler&quot;</span><span class="p">])</span>
        <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;objclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objclass</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">relfilter</span><span class="p">,</span> <span class="n">reldicts</span><span class="p">))</span></div>


<div class="viewcode-block" id="rtuple"><a class="viewcode-back" href="../../../api/nltk.sem.rtuple.html#nltk.sem.rtuple">[docs]</a><span class="k">def</span> <span class="nf">rtuple</span><span class="p">(</span><span class="n">reldict</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty print the reldict as an rtuple.</span>
<span class="sd">    :param reldict: a relation dictionary</span>
<span class="sd">    :type reldict: defaultdict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">class_abbrev</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjclass&quot;</span><span class="p">]),</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjtext&quot;</span><span class="p">],</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;filler&quot;</span><span class="p">],</span>
        <span class="n">class_abbrev</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objclass&quot;</span><span class="p">]),</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objtext&quot;</span><span class="p">],</span>
    <span class="p">]</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">] </span><span class="si">%r</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">]&quot;</span>
    <span class="k">if</span> <span class="n">lcon</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;lcon&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">items</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;...</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">+</span> <span class="nb">format</span>
    <span class="k">if</span> <span class="n">rcon</span><span class="p">:</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;rcon&quot;</span><span class="p">])</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span> <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%r</span><span class="s2">...&quot;</span>
    <span class="n">printargs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">format</span> <span class="o">%</span> <span class="n">printargs</span></div>


<div class="viewcode-block" id="clause"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.clause">[docs]</a><span class="k">def</span> <span class="nf">clause</span><span class="p">(</span><span class="n">reldict</span><span class="p">,</span> <span class="n">relsym</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the relation in clausal form.</span>
<span class="sd">    :param reldict: a relation dictionary</span>
<span class="sd">    :type reldict: defaultdict</span>
<span class="sd">    :param relsym: a label for the relation</span>
<span class="sd">    :type relsym: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">relsym</span><span class="p">,</span> <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;subjsym&quot;</span><span class="p">],</span> <span class="n">reldict</span><span class="p">[</span><span class="s2">&quot;objsym&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">items</span></div>


<span class="c1">#######################################################</span>
<span class="c1"># Demos of relation extraction with regular expressions</span>
<span class="c1">#######################################################</span>

<span class="c1">############################################</span>
<span class="c1"># Example of in(ORG, LOC)</span>
<span class="c1">############################################</span>
<div class="viewcode-block" id="in_demo"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.in_demo">[docs]</a><span class="k">def</span> <span class="nf">in_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sql</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select pairs of organizations and locations whose mentions occur with an</span>
<span class="sd">    intervening occurrence of the preposition &quot;in&quot;.</span>

<span class="sd">    If the sql parameter is set to True, then the entity pairs are loaded into</span>
<span class="sd">    an in-memory database, and subsequently pulled out using an SQL &quot;SELECT&quot;</span>
<span class="sd">    query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>

    <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">sqlite3</span>

            <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;create table Locations</span>
<span class="sd">            (OrgName text, LocationName text, DocID text)&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">warnings</span>

            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot import sqlite; sql flag will be ignored.&quot;</span><span class="p">)</span>

    <span class="n">IN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*\bin\b(?!\b.+ing)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IEER: in(ORG, LOC) -- just the clauses:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="s2">&quot;LOC&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;ieer&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">IN</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">clause</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">relsym</span><span class="o">=</span><span class="s2">&quot;IN&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rtuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="s2">&quot;subjtext&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;objtext&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                            <span class="sd">&quot;&quot;&quot;insert into Locations</span>
<span class="sd">                                    values (?, ?, ?)&quot;&quot;&quot;</span><span class="p">,</span>
                            <span class="n">rtuple</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;select OrgName from Locations</span>
<span class="sd">                        where LocationName = &#39;Atlanta&#39;&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extract data from SQL table: ORGs in Atlanta&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<span class="c1">############################################</span>
<span class="c1"># Example of has_role(PER, LOC)</span>
<span class="c1">############################################</span>


<div class="viewcode-block" id="roles_demo"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.roles_demo">[docs]</a><span class="k">def</span> <span class="nf">roles_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>

    <span class="n">roles</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (.*(                   # assorted roles</span>
<span class="s2">    analyst|</span>
<span class="s2">    chair(wo)?man|</span>
<span class="s2">    commissioner|</span>
<span class="s2">    counsel|</span>
<span class="s2">    director|</span>
<span class="s2">    economist|</span>
<span class="s2">    editor|</span>
<span class="s2">    executive|</span>
<span class="s2">    foreman|</span>
<span class="s2">    governor|</span>
<span class="s2">    head|</span>
<span class="s2">    lawyer|</span>
<span class="s2">    leader|</span>
<span class="s2">    librarian).*)|</span>
<span class="s2">    manager|</span>
<span class="s2">    partner|</span>
<span class="s2">    president|</span>
<span class="s2">    producer|</span>
<span class="s2">    professor|</span>
<span class="s2">    researcher|</span>
<span class="s2">    spokes(wo)?man|</span>
<span class="s2">    writer|</span>
<span class="s2">    ,\sof\sthe?\s*  # &quot;X, of (the) Y&quot;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">ROLES</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">roles</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IEER: has_role(PER, ORG) -- raw rtuples:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
                <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s2">&quot;PER&quot;</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;ieer&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">ROLES</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="n">lcon</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="n">rcon</span><span class="p">))</span></div>


<span class="c1">##############################################</span>
<span class="c1">### Show what&#39;s in the IEER Headlines</span>
<span class="c1">##############################################</span>


<div class="viewcode-block" id="ieer_headlines"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.ieer_headlines">[docs]</a><span class="k">def</span> <span class="nf">ieer_headlines</span><span class="p">():</span>

    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>
    <span class="kn">from</span> <span class="nn">nltk.tree</span> <span class="kn">import</span> <span class="n">Tree</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IEER: First 20 Headlines&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tree</span><span class="p">)</span></div>


<span class="c1">#############################################</span>
<span class="c1">## Dutch CONLL2002: take_on_role(PER, ORG</span>
<span class="c1">#############################################</span>


<div class="viewcode-block" id="conllned"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.conllned">[docs]</a><span class="k">def</span> <span class="nf">conllned</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the copula+&#39;van&#39; relation (&#39;of&#39;) in the Dutch tagged training corpus</span>
<span class="sd">    from CoNLL 2002.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">conll2002</span>

    <span class="n">vnv</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (</span>
<span class="s2">    is/V|    # 3rd sing present and</span>
<span class="s2">    was/V|   # past forms of the verb zijn (&#39;be&#39;)</span>
<span class="s2">    werd/V|  # and also present</span>
<span class="s2">    wordt/V  # past of worden (&#39;become)</span>
<span class="s2">    )</span>
<span class="s2">    .*       # followed by anything</span>
<span class="s2">    van/Prep # followed by van (&#39;of&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">VAN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">vnv</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dutch CoNLL2002: van(PER, ORG) -- raw rtuples with context:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">conll2002</span><span class="o">.</span><span class="n">chunked_sents</span><span class="p">(</span><span class="s2">&quot;ned.train&quot;</span><span class="p">):</span>
        <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span>
            <span class="s2">&quot;PER&quot;</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;conll2002&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">VAN</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="n">lcon</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="n">rcon</span><span class="p">))</span></div>


<span class="c1">#############################################</span>
<span class="c1">## Spanish CONLL2002: (PER, ORG)</span>
<span class="c1">#############################################</span>


<div class="viewcode-block" id="conllesp"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.conllesp">[docs]</a><span class="k">def</span> <span class="nf">conllesp</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">conll2002</span>

    <span class="n">de</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    .*</span>
<span class="s2">    (</span>
<span class="s2">    de/SP|</span>
<span class="s2">    del/SP</span>
<span class="s2">    )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">DE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">de</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spanish CoNLL2002: de(ORG, LOC) -- just the first 10 clauses:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">rel</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">conll2002</span><span class="o">.</span><span class="n">chunked_sents</span><span class="p">(</span><span class="s2">&quot;esp.train&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="s2">&quot;LOC&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;conll2002&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">DE</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">clause</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">relsym</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="ne_chunked"><a class="viewcode-back" href="../../../api/nltk.sem.relextract.html#nltk.sem.ne_chunked">[docs]</a><span class="k">def</span> <span class="nf">ne_chunked</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1500 Sentences from Penn Treebank, as processed by NLTK NE Chunker&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">ROLE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;.*(chairman|president|trader|scientist|economist|analyst|partner).*&quot;</span>
    <span class="p">)</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">treebank</span><span class="o">.</span><span class="n">tagged_sents</span><span class="p">()[:</span><span class="mi">1500</span><span class="p">]):</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">ne_chunk</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
        <span class="n">rels</span> <span class="o">=</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s2">&quot;PER&quot;</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s2">&quot;ace&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">ROLE</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}{</span><span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nltk</span>
    <span class="kn">from</span> <span class="nn">nltk.sem</span> <span class="kn">import</span> <span class="n">relextract</span>

    <span class="n">in_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">roles_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">conllned</span><span class="p">()</span>
    <span class="n">conllesp</span><span class="p">()</span>
    <span class="n">ieer_headlines</span><span class="p">()</span>
    <span class="n">ne_chunked</span><span class="p">()</span>
</pre></div>

        </div>
      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            

            
                <li class="footer-element">
                    <a href="https://github.com/nltk/nltk/tree/3.8.1">3.8.1</a>
                </li>
            

            
                <li class="footer-element">
                    Jan 02, 2023
                </li>
            
        </ul>

        
            <div id="copyright">
                &copy; 2023, NLTK Project
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/tomaarsen/nltk_theme">NLTK Theme</a>
        </div>
    </div>
</footer> 

</div>

</body>
</html>
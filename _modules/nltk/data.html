<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>NLTK :: nltk.data</title>
  

  <link rel="stylesheet" href="../../_static/css/nltk_theme.css"/>
  <link rel="stylesheet" href="../../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="nltk-theme-container">
    <header>
      <div id="logo-container">
          
          <h1>
            <a href="../../index.html">NLTK</a>
          </h1>
          
      </div>
      <div id="project-container">
        
        <h1>Documentation</h1>
        
      </div>

      <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

      <script type="text/javascript">
        $("#menu-toggle").click(function() {
          $("#menu-toggle").toggleClass("toggled");
          $("#side-menu-container").slideToggle(300);
        });
      </script>
    </header>

    <div id="content-container">

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">
          
  
    
  
  
    <p class="caption" role="heading"><span class="caption-text">NLTK Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/nltk.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto.html">Example Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki">Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki/FAQ">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/issues">Open Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk">NLTK on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installing NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">Installing NLTK Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../news.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing to NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../team.html">NLTK Team</a></li>
</ul>

  

        </div>

        
      </div>

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <h1>Source code for nltk.data</h1><div class="highlight"><pre>
<span></span><span class="c1"># Natural Language Toolkit: Utility functions</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2023 NLTK Project</span>
<span class="c1"># Author: Edward Loper &lt;edloper@gmail.com&gt;</span>
<span class="c1"># URL: &lt;https://www.nltk.org/&gt;</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions to find and load NLTK resource files, such as corpora,</span>
<span class="sd">grammars, and saved processing objects.  Resource files are identified</span>
<span class="sd">using URLs, such as ``nltk:corpora/abc/rural.txt`` or</span>
<span class="sd">``https://raw.githubusercontent.com/nltk/nltk/develop/nltk/test/toy.cfg``.</span>
<span class="sd">The following URL protocols are supported:</span>

<span class="sd">  - ``file:path``: Specifies the file whose path is *path*.</span>
<span class="sd">    Both relative and absolute paths may be used.</span>

<span class="sd">  - ``https://host/path``: Specifies the file stored on the web</span>
<span class="sd">    server *host* at path *path*.</span>

<span class="sd">  - ``nltk:path``: Specifies the file stored in the NLTK data</span>
<span class="sd">    package at *path*.  NLTK will search for these files in the</span>
<span class="sd">    directories specified by ``nltk.data.path``.</span>

<span class="sd">If no protocol is specified, then the default protocol ``nltk:`` will</span>
<span class="sd">be used.</span>

<span class="sd">This module provides to functions that can be used to access a</span>
<span class="sd">resource file, given its URL: ``load()`` loads a given resource, and</span>
<span class="sd">adds it to a resource cache; and ``retrieve()`` copies a given resource</span>
<span class="sd">to a local file.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="n">WRITE</span> <span class="k">as</span> <span class="n">GZ_WRITE</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="n">GzipFile</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span><span class="p">,</span> <span class="n">TextIOWrapper</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">url2pathname</span><span class="p">,</span> <span class="n">urlopen</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">Z_SYNC_FLUSH</span> <span class="k">as</span> <span class="n">FLUSH</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">Z_FINISH</span> <span class="k">as</span> <span class="n">FLUSH</span>

<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">sem</span>
<span class="kn">from</span> <span class="nn">nltk.compat</span> <span class="kn">import</span> <span class="n">add_py3_data</span><span class="p">,</span> <span class="n">py3_data</span>
<span class="kn">from</span> <span class="nn">nltk.internals</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="n">textwrap_indent</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>

<span class="c1">######################################################################</span>
<span class="c1"># Search Path</span>
<span class="c1">######################################################################</span>

<span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="sd">&quot;&quot;&quot;A list of directories where the NLTK data package might reside.</span>
<span class="sd">   These directories will be checked in order when looking for a</span>
<span class="sd">   resource in the data package.  Note that this allows users to</span>
<span class="sd">   substitute in their own versions of resources, if they have them</span>
<span class="sd">   (e.g., in their home directory under ~/nltk_data).&quot;&quot;&quot;</span>

<span class="c1"># User-specified locations:</span>
<span class="n">_paths_from_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NLTK_DATA&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
<span class="n">path</span> <span class="o">+=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">_paths_from_env</span> <span class="k">if</span> <span class="n">d</span><span class="p">]</span>
<span class="k">if</span> <span class="s2">&quot;APPENGINE_RUNTIME&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;~/&quot;</span><span class="p">:</span>
    <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/nltk_data&quot;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;win&quot;</span><span class="p">):</span>
    <span class="c1"># Common locations on Windows:</span>
    <span class="n">path</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;APPDATA&quot;</span><span class="p">,</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">),</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="sa">r</span><span class="s2">&quot;C:\nltk_data&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;D:\nltk_data&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;E:\nltk_data&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Common locations on UNIX &amp; OS X:</span>
    <span class="n">path</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">),</span>
        <span class="s2">&quot;/usr/share/nltk_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/usr/local/share/nltk_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/usr/lib/nltk_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/usr/local/lib/nltk_data&quot;</span><span class="p">,</span>
    <span class="p">]</span>


<span class="c1">######################################################################</span>
<span class="c1"># Util Functions</span>
<span class="c1">######################################################################</span>


<span class="k">def</span> <span class="nf">gzip_open_unicode</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span>
    <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fileobj</span> <span class="o">=</span> <span class="n">GzipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">compresslevel</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">split_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits a resource url into &quot;&lt;protocol&gt;:&lt;path&gt;&quot;.</span>

<span class="sd">    &gt;&gt;&gt; windows = sys.platform.startswith(&#39;win&#39;)</span>
<span class="sd">    &gt;&gt;&gt; split_resource_url(&#39;nltk:home/nltk&#39;)</span>
<span class="sd">    (&#39;nltk&#39;, &#39;home/nltk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; split_resource_url(&#39;nltk:/home/nltk&#39;)</span>
<span class="sd">    (&#39;nltk&#39;, &#39;/home/nltk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; split_resource_url(&#39;file:/home/nltk&#39;)</span>
<span class="sd">    (&#39;file&#39;, &#39;/home/nltk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; split_resource_url(&#39;file:///home/nltk&#39;)</span>
<span class="sd">    (&#39;file&#39;, &#39;/home/nltk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; split_resource_url(&#39;file:///C:/home/nltk&#39;)</span>
<span class="sd">    (&#39;file&#39;, &#39;/C:/home/nltk&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">protocol</span><span class="p">,</span> <span class="n">path_</span> <span class="o">=</span> <span class="n">resource_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">&quot;nltk&quot;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">path_</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">path_</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^/{0,2}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">path_</span>


<span class="k">def</span> <span class="nf">normalize_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a resource url</span>

<span class="sd">    &gt;&gt;&gt; windows = sys.platform.startswith(&#39;win&#39;)</span>
<span class="sd">    &gt;&gt;&gt; os.path.normpath(split_resource_url(normalize_resource_url(&#39;file:grammar.fcfg&#39;))[1]) == \</span>
<span class="sd">    ... (&#39;\\&#39; if windows else &#39;&#39;) + os.path.abspath(os.path.join(os.curdir, &#39;grammar.fcfg&#39;))</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;file:C:/dir/file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;file:C:\\dir\\file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;file:C:\\dir/file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;file://C:/dir/file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;file:////C:/dir/file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;nltk:C:/dir/file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_url(&#39;nltk:C:\\dir\\file&#39;) == &#39;file:///C:/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_url(&#39;file:/dir/file/toy.cfg&#39;) == &#39;file:///dir/file/toy.cfg&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; normalize_resource_url(&#39;nltk:home/nltk&#39;)</span>
<span class="sd">    &#39;nltk:home/nltk&#39;</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_url(&#39;nltk:/home/nltk&#39;) == &#39;file:///home/nltk&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; normalize_resource_url(&#39;https://example.com/dir/file&#39;)</span>
<span class="sd">    &#39;https://example.com/dir/file&#39;</span>
<span class="sd">    &gt;&gt;&gt; normalize_resource_url(&#39;dir/file&#39;)</span>
<span class="sd">    &#39;nltk:dir/file&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">protocol</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># the resource url has no protocol, use the nltk protocol by default</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">&quot;nltk&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">resource_url</span>
    <span class="c1"># use file protocol if the path is an absolute path</span>
    <span class="k">if</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">&quot;nltk&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">&quot;file://&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">normalize_resource_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">&quot;file://&quot;</span>
        <span class="c1"># name is absolute</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">normalize_resource_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">&quot;nltk&quot;</span><span class="p">:</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">&quot;nltk:&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">normalize_resource_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># handled by urllib</span>
        <span class="n">protocol</span> <span class="o">+=</span> <span class="s2">&quot;://&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">protocol</span><span class="p">,</span> <span class="n">name</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">normalize_resource_name</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">allow_relative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">relative_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :type resource_name: str or unicode</span>
<span class="sd">    :param resource_name: The name of the resource to search for.</span>
<span class="sd">        Resource names are posix-style relative path names, such as</span>
<span class="sd">        ``corpora/brown``.  Directory names will automatically</span>
<span class="sd">        be converted to a platform-appropriate path separator.</span>
<span class="sd">        Directory trailing slashes are preserved</span>

<span class="sd">    &gt;&gt;&gt; windows = sys.platform.startswith(&#39;win&#39;)</span>
<span class="sd">    &gt;&gt;&gt; normalize_resource_name(&#39;.&#39;, True)</span>
<span class="sd">    &#39;./&#39;</span>
<span class="sd">    &gt;&gt;&gt; normalize_resource_name(&#39;./&#39;, True)</span>
<span class="sd">    &#39;./&#39;</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_name(&#39;dir/file&#39;, False, &#39;/&#39;) == &#39;/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_name(&#39;C:/file&#39;, False, &#39;/&#39;) == &#39;/C:/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_name(&#39;/dir/file&#39;, False, &#39;/&#39;) == &#39;/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_name(&#39;../dir/file&#39;, False, &#39;/&#39;) == &#39;/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; not windows or normalize_resource_name(&#39;/dir/file&#39;, True, &#39;/&#39;) == &#39;dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; windows or normalize_resource_name(&#39;/dir/file&#39;, True, &#39;/&#39;) == &#39;/dir/file&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_dir</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[</span><span class="se">\\</span><span class="s2">/.]$&quot;</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">))</span> <span class="ow">or</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;win&quot;</span><span class="p">):</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^/+&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">allow_relative</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relative_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relative_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relative_path</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">))</span>
    <span class="n">resource_name</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;win&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">resource_name</span><span class="p">):</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">resource_name</span>
    <span class="k">if</span> <span class="n">is_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
        <span class="n">resource_name</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
    <span class="k">return</span> <span class="n">resource_name</span>


<span class="c1">######################################################################</span>
<span class="c1"># Path Pointers</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="PathPointer"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.PathPointer">[docs]</a><span class="k">class</span> <span class="nc">PathPointer</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract base class for &#39;path pointers,&#39; used by NLTK&#39;s data</span>
<span class="sd">    package to identify specific paths.  Two subclasses exist:</span>
<span class="sd">    ``FileSystemPathPointer`` identifies a file that can be accessed</span>
<span class="sd">    directly via a given absolute path.  ``ZipFilePathPointer``</span>
<span class="sd">    identifies a file contained within a zipfile, that can be accessed</span>
<span class="sd">    by reading that zipfile.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PathPointer.open"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.PathPointer.open">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a seekable read-only stream that can be used to read</span>
<span class="sd">        the contents of the file identified by this path pointer.</span>

<span class="sd">        :raise IOError: If the path specified by this pointer does</span>
<span class="sd">            not contain a readable file.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="PathPointer.file_size"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.PathPointer.file_size">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the size of the file pointed to by this path pointer,</span>
<span class="sd">        in bytes.</span>

<span class="sd">        :raise IOError: If the path specified by this pointer does</span>
<span class="sd">            not contain a readable file.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="PathPointer.join"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.PathPointer.join">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new path pointer formed by starting at the path</span>
<span class="sd">        identified by this pointer, and then following the relative</span>
<span class="sd">        path given by ``fileid``.  The path components of ``fileid``</span>
<span class="sd">        should be separated by forward slashes, regardless of</span>
<span class="sd">        the underlying file system&#39;s path separator character.</span>
<span class="sd">        &quot;&quot;&quot;</span></div></div>


<div class="viewcode-block" id="FileSystemPathPointer"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.FileSystemPathPointer">[docs]</a><span class="k">class</span> <span class="nc">FileSystemPathPointer</span><span class="p">(</span><span class="n">PathPointer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A path pointer that identifies a file which can be accessed</span>
<span class="sd">    directly via a given absolute path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FileSystemPathPointer.__init__"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.FileSystemPathPointer.__init__">[docs]</a>    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new path pointer for the given absolute path.</span>

<span class="sd">        :raise IOError: If the given path does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;No such file or directory: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">_path</span></div>

        <span class="c1"># There&#39;s no need to call str.__init__(), since it&#39;s a no-op;</span>
        <span class="c1"># str does all of its setup work in __new__.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The absolute path identified by this path pointer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

<div class="viewcode-block" id="FileSystemPathPointer.open"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.FileSystemPathPointer.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">SeekableUnicodeStreamReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span></div>

<div class="viewcode-block" id="FileSystemPathPointer.file_size"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.FileSystemPathPointer.file_size">[docs]</a>    <span class="k">def</span> <span class="nf">file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span></div>

<div class="viewcode-block" id="FileSystemPathPointer.join"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.FileSystemPathPointer.join">[docs]</a>    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileid</span><span class="p">):</span>
        <span class="n">_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">fileid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FileSystemPathPointer</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;FileSystemPathPointer(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span></div>


<span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Use gzip.GzipFile instead as it also uses a buffer.&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BufferedGzipFile</span><span class="p">(</span><span class="n">GzipFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``GzipFile`` subclass for compatibility with older nltk releases.</span>

<span class="sd">    Use ``GzipFile`` directly as it also buffers in all supported</span>
<span class="sd">    Python versions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a buffered gzip file object.&quot;&quot;&quot;</span>
        <span class="n">GzipFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">compresslevel</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># This is identical to GzipFile.write but does not return</span>
        <span class="c1"># the bytes written to retain compatibility.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<div class="viewcode-block" id="GzipFileSystemPathPointer"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.GzipFileSystemPathPointer">[docs]</a><span class="k">class</span> <span class="nc">GzipFileSystemPathPointer</span><span class="p">(</span><span class="n">FileSystemPathPointer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of ``FileSystemPathPointer`` that identifies a gzip-compressed</span>
<span class="sd">    file located at a given absolute path.  ``GzipFileSystemPathPointer`` is</span>
<span class="sd">    appropriate for loading large gzip-compressed pickle objects efficiently.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GzipFileSystemPathPointer.open"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.GzipFileSystemPathPointer.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">GzipFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">SeekableUnicodeStreamReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span></div></div>


<span class="k">class</span> <span class="nc">ZipFilePathPointer</span><span class="p">(</span><span class="n">PathPointer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A path pointer that identifies a file contained within a zipfile,</span>
<span class="sd">    which can be accessed by reading that zipfile.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zipfile</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new path pointer pointing at the specified entry</span>
<span class="sd">        in the given zipfile.</span>

<span class="sd">        :raise IOError: If the given zipfile does not exist, or if it</span>
<span class="sd">        does not contain the specified entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zipfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">zipfile</span> <span class="o">=</span> <span class="n">OpenOnDemandZipFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">zipfile</span><span class="p">))</span>

        <span class="c1"># Check that the entry exists:</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>

            <span class="c1"># Normalize the entry string, it should be relative:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">normalize_resource_name</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">zipfile</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Sometimes directories aren&#39;t explicitly listed in</span>
                <span class="c1"># the zip file.  So if `entry` is a directory name,</span>
                <span class="c1"># then check if the zipfile contains any files that</span>
                <span class="c1"># are under the given directory.</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">[</span>
                    <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="p">]:</span>
                    <span class="k">pass</span>  <span class="c1"># zipfile contains a file in that directory.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Otherwise, complain.</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Zipfile </span><span class="si">{</span><span class="n">zipfile</span><span class="o">.</span><span class="n">filename</span><span class="si">!r}</span><span class="s2"> does not contain </span><span class="si">{</span><span class="n">entry</span><span class="si">!r}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span> <span class="o">=</span> <span class="n">zipfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zipfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The zipfile.ZipFile object used to access the zip file</span>
<span class="sd">        containing the entry identified by this path pointer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the file within zipfile that this path</span>
<span class="sd">        pointer points to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">GzipFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">SeekableUnicodeStreamReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span>

    <span class="k">def</span> <span class="nf">file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">)</span><span class="o">.</span><span class="n">file_size</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileid</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fileid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">ZipFilePathPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ZipFilePathPointer(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span><span class="o">.</span><span class="n">filename</span><span class="si">!r}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="si">!r}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zipfile</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">))</span>


<span class="c1">######################################################################</span>
<span class="c1"># Access Functions</span>
<span class="c1">######################################################################</span>

<span class="c1"># Don&#39;t use a weak dictionary, because in the common case this</span>
<span class="c1"># causes a lot more reloading that necessary.</span>
<span class="n">_resource_cache</span> <span class="o">=</span> <span class="p">{}</span>
<span class="sd">&quot;&quot;&quot;A dictionary used to cache resources so that they won&#39;t</span>
<span class="sd">   need to be loaded more than once.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="find"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the given resource by searching through the directories and</span>
<span class="sd">    zip files in paths, where a None or empty string specifies an absolute path.</span>
<span class="sd">    Returns a corresponding path name.  If the given resource is not</span>
<span class="sd">    found, raise a ``LookupError``, whose message gives a pointer to</span>
<span class="sd">    the installation instructions for the NLTK downloader.</span>

<span class="sd">    Zip File Handling:</span>

<span class="sd">      - If ``resource_name`` contains a component with a ``.zip``</span>
<span class="sd">        extension, then it is assumed to be a zipfile; and the</span>
<span class="sd">        remaining path components are used to look inside the zipfile.</span>

<span class="sd">      - If any element of ``nltk.data.path`` has a ``.zip`` extension,</span>
<span class="sd">        then it is assumed to be a zipfile.</span>

<span class="sd">      - If a given resource name that does not contain any zipfile</span>
<span class="sd">        component is not found initially, then ``find()`` will make a</span>
<span class="sd">        second attempt to find that resource, by replacing each</span>
<span class="sd">        component *p* in the path with *p.zip/p*.  For example, this</span>
<span class="sd">        allows ``find()`` to map the resource name</span>
<span class="sd">        ``corpora/chat80/cities.pl`` to a zip file path pointer to</span>
<span class="sd">        ``corpora/chat80.zip/chat80/cities.pl``.</span>

<span class="sd">      - When using ``find()`` to locate a directory contained in a</span>
<span class="sd">        zipfile, the resource name must end with the forward slash</span>
<span class="sd">        character.  Otherwise, ``find()`` will not locate the</span>
<span class="sd">        directory.</span>

<span class="sd">    :type resource_name: str or unicode</span>
<span class="sd">    :param resource_name: The name of the resource to search for.</span>
<span class="sd">        Resource names are posix-style relative path names, such as</span>
<span class="sd">        ``corpora/brown``.  Directory names will be</span>
<span class="sd">        automatically converted to a platform-appropriate path separator.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_name</span> <span class="o">=</span> <span class="n">normalize_resource_name</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Resolve default paths at runtime in-case the user overrides</span>
    <span class="c1"># nltk.data.path</span>
    <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">path</span>

    <span class="c1"># Check if the resource name includes a zipfile name</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*\.zip)/?(.*)$|&quot;</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
    <span class="n">zipfile</span><span class="p">,</span> <span class="n">zipentry</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

    <span class="c1"># Check each item in our path</span>
    <span class="k">for</span> <span class="n">path_</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="c1"># Is the path item a zipfile?</span>
        <span class="k">if</span> <span class="n">path_</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path_</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ZipFilePathPointer</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># resource not in zipfile</span>
                <span class="k">continue</span>

        <span class="c1"># Is the path item a directory or is resource_name an absolute path?</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path_</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">zipfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">url2pathname</span><span class="p">(</span><span class="n">resource_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">GzipFileSystemPathPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">FileSystemPathPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">url2pathname</span><span class="p">(</span><span class="n">zipfile</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">ZipFilePathPointer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">zipentry</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="c1"># resource not in zipfile</span>
                        <span class="k">continue</span>

    <span class="c1"># Fallback: if the path doesn&#39;t include a zip file, then try</span>
    <span class="c1"># again, assuming that one of the path components is inside a</span>
    <span class="c1"># zipfile of the same name.</span>
    <span class="k">if</span> <span class="n">zipfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pieces</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)):</span>
            <span class="n">modified_name</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">pieces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pieces</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">modified_name</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="c1"># Identify the package (i.e. the .zip file) to download.</span>
    <span class="n">resource_zipname</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resource_zipname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
        <span class="n">resource_zipname</span> <span class="o">=</span> <span class="n">resource_zipname</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Display a friendly error message if the resource wasn&#39;t found:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="s2">&quot;Resource </span><span class="se">\33</span><span class="s2">[93m</span><span class="si">{resource}</span><span class="se">\033</span><span class="s2">[0m not found.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Please use the NLTK Downloader to obtain the resource:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="se">\33</span><span class="s2">[31m&quot;</span>  <span class="c1"># To display red text in terminal.</span>
        <span class="s2">&quot;&gt;&gt;&gt; import nltk</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&gt;&gt;&gt; nltk.download(&#39;</span><span class="si">{resource}</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource_zipname</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">textwrap_indent</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  For more information see: https://www.nltk.org/data.html</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Attempted to load </span><span class="se">\33</span><span class="s2">[93m</span><span class="si">{resource_name}</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">resource_name</span><span class="o">=</span><span class="n">resource_name</span>
    <span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Searched in:&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">)</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">70</span>
    <span class="n">resource_not_found</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">resource_not_found</span><span class="p">)</span></div>


<div class="viewcode-block" id="retrieve"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.retrieve">[docs]</a><span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="n">resource_url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy the given resource to a local file.  If no filename is</span>
<span class="sd">    specified, then use the URL&#39;s filename.  If there is already a</span>
<span class="sd">    file named ``filename``, then raise a ``ValueError``.</span>

<span class="sd">    :type resource_url: str</span>
<span class="sd">    :param resource_url: A URL specifying where the resource should be</span>
<span class="sd">        loaded from.  The default protocol is &quot;nltk:&quot;, which searches</span>
<span class="sd">        for the file in the the NLTK data package.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_url</span> <span class="o">=</span> <span class="n">normalize_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resource_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;file:&quot;</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(^\w+:)?.*/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">resource_url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%r</span><span class="s2"> already exists!&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving </span><span class="si">{</span><span class="n">resource_url</span><span class="si">!r}</span><span class="s2">, saving to </span><span class="si">{</span><span class="n">filename</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Open the input &amp; output streams.</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">_open</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>

    <span class="c1"># Copy infile -&gt; outfile, using 64k blocks.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span>  <span class="c1"># 64k blocks.</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1">#: A dictionary describing the formats that are supported by NLTK&#39;s</span>
<span class="c1">#: load() method.  Keys are format names, and values are format</span>
<span class="c1">#: descriptions.</span>
<span class="n">FORMATS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pickle&quot;</span><span class="p">:</span> <span class="s2">&quot;A serialized python object, stored using the pickle module.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="s2">&quot;A serialized python object, stored using the json module.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yaml&quot;</span><span class="p">:</span> <span class="s2">&quot;A serialized python object, stored using the yaml module.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cfg&quot;</span><span class="p">:</span> <span class="s2">&quot;A context free grammar.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pcfg&quot;</span><span class="p">:</span> <span class="s2">&quot;A probabilistic CFG.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fcfg&quot;</span><span class="p">:</span> <span class="s2">&quot;A feature CFG.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fol&quot;</span><span class="p">:</span> <span class="s2">&quot;A list of first order logic expressions, parsed with &quot;</span>
    <span class="s2">&quot;nltk.sem.logic.Expression.fromstring.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="s2">&quot;A list of first order logic expressions, parsed with &quot;</span>
    <span class="s2">&quot;nltk.sem.logic.LogicParser.  Requires an additional logic_parser &quot;</span>
    <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="s2">&quot;A semantic valuation, parsed by nltk.sem.Valuation.fromstring.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="s2">&quot;The raw (byte string) contents of a file.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;The raw (unicode string) contents of a file. &quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">#: A dictionary mapping from file extensions to format names, used</span>
<span class="c1">#: by load() when format=&quot;auto&quot; to decide the format for a</span>
<span class="c1">#: given resource url.</span>
<span class="n">AUTO_FORMATS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pickle&quot;</span><span class="p">:</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yaml&quot;</span><span class="p">:</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cfg&quot;</span><span class="p">:</span> <span class="s2">&quot;cfg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pcfg&quot;</span><span class="p">:</span> <span class="s2">&quot;pcfg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fcfg&quot;</span><span class="p">:</span> <span class="s2">&quot;fcfg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fol&quot;</span><span class="p">:</span> <span class="s2">&quot;fol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="s2">&quot;logic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
    <span class="s2">&quot;txt&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
    <span class="n">resource_url</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">logic_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fstruct_reader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a given resource from the NLTK data package.  The following</span>
<span class="sd">    resource formats are currently supported:</span>

<span class="sd">      - ``pickle``</span>
<span class="sd">      - ``json``</span>
<span class="sd">      - ``yaml``</span>
<span class="sd">      - ``cfg`` (context free grammars)</span>
<span class="sd">      - ``pcfg`` (probabilistic CFGs)</span>
<span class="sd">      - ``fcfg`` (feature-based CFGs)</span>
<span class="sd">      - ``fol`` (formulas of First Order Logic)</span>
<span class="sd">      - ``logic`` (Logical formulas to be parsed by the given logic_parser)</span>
<span class="sd">      - ``val`` (valuation of First Order Logic model)</span>
<span class="sd">      - ``text`` (the file contents as a unicode string)</span>
<span class="sd">      - ``raw`` (the raw file contents as a byte string)</span>

<span class="sd">    If no format is specified, ``load()`` will attempt to determine a</span>
<span class="sd">    format based on the resource name&#39;s file extension.  If that</span>
<span class="sd">    fails, ``load()`` will raise a ``ValueError`` exception.</span>

<span class="sd">    For all text formats (everything except ``pickle``, ``json``, ``yaml`` and ``raw``),</span>
<span class="sd">    it tries to decode the raw contents using UTF-8, and if that doesn&#39;t</span>
<span class="sd">    work, it tries with ISO-8859-1 (Latin-1), unless the ``encoding``</span>
<span class="sd">    is specified.</span>

<span class="sd">    :type resource_url: str</span>
<span class="sd">    :param resource_url: A URL specifying where the resource should be</span>
<span class="sd">        loaded from.  The default protocol is &quot;nltk:&quot;, which searches</span>
<span class="sd">        for the file in the the NLTK data package.</span>
<span class="sd">    :type cache: bool</span>
<span class="sd">    :param cache: If true, add this resource to a cache.  If load()</span>
<span class="sd">        finds a resource in its cache, then it will return it from the</span>
<span class="sd">        cache rather than loading it.</span>
<span class="sd">    :type verbose: bool</span>
<span class="sd">    :param verbose: If true, print a message when loading a resource.</span>
<span class="sd">        Messages are not displayed when a resource is retrieved from</span>
<span class="sd">        the cache.</span>
<span class="sd">    :type logic_parser: LogicParser</span>
<span class="sd">    :param logic_parser: The parser that will be used to parse logical</span>
<span class="sd">        expressions.</span>
<span class="sd">    :type fstruct_reader: FeatStructReader</span>
<span class="sd">    :param fstruct_reader: The parser that will be used to parse the</span>
<span class="sd">        feature structure of an fcfg.</span>
<span class="sd">    :type encoding: str</span>
<span class="sd">    :param encoding: the encoding of the input; only used for text formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_url</span> <span class="o">=</span> <span class="n">normalize_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>
    <span class="n">resource_url</span> <span class="o">=</span> <span class="n">add_py3_data</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>

    <span class="c1"># Determine the format of the resource.</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="n">resource_url_parts</span> <span class="o">=</span> <span class="n">resource_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">resource_url_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;gz&quot;</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">resource_url_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">AUTO_FORMATS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Could not determine format for </span><span class="si">%s</span><span class="s2"> based &quot;</span>
                <span class="s1">&#39;on its file</span><span class="se">\n</span><span class="s1">extension; use the &quot;format&quot; &#39;</span>
                <span class="s2">&quot;argument to specify the format explicitly.&quot;</span> <span class="o">%</span> <span class="n">resource_url</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FORMATS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown format type: </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

    <span class="c1"># If we&#39;ve cached the resource, then just return it.</span>
    <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
        <span class="n">resource_val</span> <span class="o">=</span> <span class="n">_resource_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">resource_url</span><span class="p">,</span> <span class="nb">format</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resource_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;&lt;Using cached copy of </span><span class="si">{</span><span class="n">resource_url</span><span class="si">}</span><span class="s2">&gt;&gt;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resource_val</span>

    <span class="c1"># Let the user know what&#39;s going on.</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;&lt;Loading </span><span class="si">{</span><span class="n">resource_url</span><span class="si">}</span><span class="s2">&gt;&gt;&quot;</span><span class="p">)</span>

    <span class="c1"># Load the resource.</span>
    <span class="n">opened_resource</span> <span class="o">=</span> <span class="n">_open</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="n">resource_val</span> <span class="o">=</span> <span class="n">opened_resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
        <span class="n">resource_val</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">opened_resource</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">json</span>

        <span class="kn">from</span> <span class="nn">nltk.jsontags</span> <span class="kn">import</span> <span class="n">json_tags</span>

        <span class="n">resource_val</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">opened_resource</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_val</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">resource_val</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_tags</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown json tag.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;yaml&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">yaml</span>

        <span class="n">resource_val</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">opened_resource</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The resource is a text format.</span>
        <span class="n">binary_data</span> <span class="o">=</span> <span class="n">opened_resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string_data</span> <span class="o">=</span> <span class="n">binary_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">string_data</span> <span class="o">=</span> <span class="n">binary_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="n">string_data</span> <span class="o">=</span> <span class="n">binary_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">string_data</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;cfg&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">CFG</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string_data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;pcfg&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">PCFG</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string_data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;fcfg&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">FeatureGrammar</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span>
                <span class="n">string_data</span><span class="p">,</span>
                <span class="n">logic_parser</span><span class="o">=</span><span class="n">logic_parser</span><span class="p">,</span>
                <span class="n">fstruct_reader</span><span class="o">=</span><span class="n">fstruct_reader</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;fol&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">sem</span><span class="o">.</span><span class="n">read_logic</span><span class="p">(</span>
                <span class="n">string_data</span><span class="p">,</span>
                <span class="n">logic_parser</span><span class="o">=</span><span class="n">sem</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">LogicParser</span><span class="p">(),</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;logic&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">sem</span><span class="o">.</span><span class="n">read_logic</span><span class="p">(</span>
                <span class="n">string_data</span><span class="p">,</span> <span class="n">logic_parser</span><span class="o">=</span><span class="n">logic_parser</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span>
            <span class="n">resource_val</span> <span class="o">=</span> <span class="n">sem</span><span class="o">.</span><span class="n">read_valuation</span><span class="p">(</span><span class="n">string_data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Internal NLTK error: Format </span><span class="si">%s</span><span class="s2"> isn&#39;t &quot;</span>
                <span class="s2">&quot;handled by nltk.data.load()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">,)</span>
            <span class="p">)</span>

    <span class="n">opened_resource</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># If requested, add it to the cache.</span>
    <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_resource_cache</span><span class="p">[(</span><span class="n">resource_url</span><span class="p">,</span> <span class="nb">format</span><span class="p">)]</span> <span class="o">=</span> <span class="n">resource_val</span>
            <span class="c1"># TODO: add this line</span>
            <span class="c1"># print(&#39;&lt;&lt;Caching a copy of %s&gt;&gt;&#39; % (resource_url,))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># We can&#39;t create weak references to some object types, like</span>
            <span class="c1"># strings and tuples.  For now, just don&#39;t cache them.</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">resource_val</span></div>


<div class="viewcode-block" id="show_cfg"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.show_cfg">[docs]</a><span class="k">def</span> <span class="nf">show_cfg</span><span class="p">(</span><span class="n">resource_url</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="s2">&quot;##&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write out a grammar file, ignoring escaped and empty lines.</span>

<span class="sd">    :type resource_url: str</span>
<span class="sd">    :param resource_url: A URL specifying where the resource should be</span>
<span class="sd">        loaded from.  The default protocol is &quot;nltk:&quot;, which searches</span>
<span class="sd">        for the file in the the NLTK data package.</span>
<span class="sd">    :type escape: str</span>
<span class="sd">    :param escape: Prepended string that signals lines to be ignored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_url</span> <span class="o">=</span> <span class="n">normalize_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>
    <span class="n">resource_val</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">resource_url</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">resource_val</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">escape</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^$&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>


<div class="viewcode-block" id="clear_cache"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.clear_cache">[docs]</a><span class="k">def</span> <span class="nf">clear_cache</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove all objects from the resource cache.</span>
<span class="sd">    :see: load()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_resource_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="n">resource_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function that returns an open file object for a resource,</span>
<span class="sd">    given its resource URL.  If the given resource URL uses the &quot;nltk:&quot;</span>
<span class="sd">    protocol, or uses no protocol, then use ``nltk.data.find`` to find</span>
<span class="sd">    its path, and open it with the given mode; if the resource URL</span>
<span class="sd">    uses the &#39;file&#39; protocol, then open the file with the given mode;</span>
<span class="sd">    otherwise, delegate to ``urllib2.urlopen``.</span>

<span class="sd">    :type resource_url: str</span>
<span class="sd">    :param resource_url: A URL specifying where the resource should be</span>
<span class="sd">        loaded from.  The default protocol is &quot;nltk:&quot;, which searches</span>
<span class="sd">        for the file in the the NLTK data package.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_url</span> <span class="o">=</span> <span class="n">normalize_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>
    <span class="n">protocol</span><span class="p">,</span> <span class="n">path_</span> <span class="o">=</span> <span class="n">split_resource_url</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">protocol</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;nltk&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">protocol</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="c1"># urllib might not use mode=&#39;rb&#39;, so handle this one ourselves:</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">resource_url</span><span class="p">)</span>


<span class="c1">######################################################################</span>
<span class="c1"># Lazy Resource Loader</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="LazyLoader"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.LazyLoader">[docs]</a><span class="k">class</span> <span class="nc">LazyLoader</span><span class="p">:</span>
<div class="viewcode-block" id="LazyLoader.__init__"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.LazyLoader.__init__">[docs]</a>    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">_path</span></div>

    <span class="k">def</span> <span class="nf">__load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="c1"># This is where the magic happens!  Transform ourselves into</span>
        <span class="c1"># the object by modifying our own __dict__ and __class__ to</span>
        <span class="c1"># match that of `resource`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="vm">__class__</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load</span><span class="p">()</span>
        <span class="c1"># This looks circular, but its not, since __load() changes our</span>
        <span class="c1"># __class__ to something new:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load</span><span class="p">()</span>
        <span class="c1"># This looks circular, but its not, since __load() changes our</span>
        <span class="c1"># __class__ to something new:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Open-On-Demand ZipFile</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="OpenOnDemandZipFile"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.OpenOnDemandZipFile">[docs]</a><span class="k">class</span> <span class="nc">OpenOnDemandZipFile</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of ``zipfile.ZipFile`` that closes its file pointer</span>
<span class="sd">    whenever it is not using it; and re-opens it when it needs to read</span>
<span class="sd">    data from the zipfile.  This is useful for reducing the number of</span>
<span class="sd">    open file handles when many zip files are being accessed at once.</span>
<span class="sd">    ``OpenOnDemandZipFile`` must be constructed from a filename, not a</span>
<span class="sd">    file-like object (to allow re-opening).  ``OpenOnDemandZipFile`` is</span>
<span class="sd">    read-only (i.e. ``write()`` and ``writestr()`` are disabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OpenOnDemandZipFile.__init__"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.OpenOnDemandZipFile.__init__">[docs]</a>    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ReopenableZipFile filename must be a string&quot;</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># After closing a ZipFile object, the _fileRefCnt needs to be cleared</span>
        <span class="c1"># for Python2and3 compatible code.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileRefCnt</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="OpenOnDemandZipFile.read"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.OpenOnDemandZipFile.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># Ensure that _fileRefCnt needs to be set for Python2and3 compatible code.</span>
        <span class="c1"># Since we only opened one file here, we add 1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileRefCnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="OpenOnDemandZipFile.write"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.OpenOnDemandZipFile.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:raise NotImplementedError: OpenOnDemandZipfile is read-only&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;OpenOnDemandZipfile is read-only&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenOnDemandZipFile.writestr"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.OpenOnDemandZipFile.writestr">[docs]</a>    <span class="k">def</span> <span class="nf">writestr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:raise NotImplementedError: OpenOnDemandZipfile is read-only&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;OpenOnDemandZipfile is read-only&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="s2">&quot;OpenOnDemandZipFile(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Seekable Unicode Stream Reader</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="SeekableUnicodeStreamReader"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader">[docs]</a><span class="k">class</span> <span class="nc">SeekableUnicodeStreamReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stream reader that automatically encodes the source byte stream</span>
<span class="sd">    into unicode (like ``codecs.StreamReader``); but still supports the</span>
<span class="sd">    ``seek()`` and ``tell()`` operations correctly.  This is in contrast</span>
<span class="sd">    to ``codecs.StreamReader``, which provide *broken* ``seek()`` and</span>
<span class="sd">    ``tell()`` methods.</span>

<span class="sd">    This class was motivated by ``StreamBackedCorpusView``, which</span>
<span class="sd">    makes extensive use of ``seek()`` and ``tell()``, and needs to be</span>
<span class="sd">    able to handle unicode-encoded files.</span>

<span class="sd">    Note: this class requires stateless decoders.  To my knowledge,</span>
<span class="sd">    this shouldn&#39;t cause a problem with any of python&#39;s builtin</span>
<span class="sd">    unicode encodings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># : If true, then perform extra sanity checks.</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.__init__"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.__init__">[docs]</a>    <span class="nd">@py3_data</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">):</span>
        <span class="c1"># Rewind the stream to its beginning.</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="sd">&quot;&quot;&quot;The underlying stream.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="sd">&quot;&quot;&quot;The name of the encoding that should be used to encode the</span>
<span class="sd">           underlying stream.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span>
        <span class="sd">&quot;&quot;&quot;The error mode that should be used when decoding data from</span>
<span class="sd">           the underlying stream.  Can be &#39;strict&#39;, &#39;ignore&#39;, or</span>
<span class="sd">           &#39;replace&#39;.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The function that is used to decode byte strings into</span>
<span class="sd">           unicode strings.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;A buffer to use bytes that have been read but have not yet</span>
<span class="sd">           been decoded.  This is only used when the final bytes from</span>
<span class="sd">           a read do not form a complete encoding for a character.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;A buffer used by ``readline()`` to hold characters that have</span>
<span class="sd">           been read, but have not yet been returned by ``read()`` or</span>
<span class="sd">           ``readline()``.  This buffer consists of a list of unicode</span>
<span class="sd">           strings, where each string corresponds to a single line.</span>
<span class="sd">           The final element of the list may or may not be a complete</span>
<span class="sd">           line.  Note that the existence of a linebuffer makes the</span>
<span class="sd">           ``tell()`` operation more complex, because it must backtrack</span>
<span class="sd">           to the beginning of the buffer to determine the correct</span>
<span class="sd">           file position in the underlying byte stream.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_checkpoint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="sd">&quot;&quot;&quot;The file position at which the most recent read on the</span>
<span class="sd">           underlying stream began.  This is used, together with</span>
<span class="sd">           ``_rewind_numchars``, to backtrack to the beginning of</span>
<span class="sd">           ``linebuffer`` (which is required by ``tell()``).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;The number of characters that have been returned since the</span>
<span class="sd">           read that started at ``_rewind_checkpoint``.  This is used,</span>
<span class="sd">           together with ``_rewind_checkpoint``, to backtrack to the</span>
<span class="sd">           beginning of ``linebuffer`` (which is required by ``tell()``).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bom</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;The length of the byte order marker at the beginning of</span>
<span class="sd">           the stream (or None for no byte order marker).&quot;&quot;&quot;</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Read methods</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.read"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read up to ``size`` bytes, decode them using this reader&#39;s</span>
<span class="sd">        encoding, and return the resulting unicode string.</span>

<span class="sd">        :param size: The maximum number of bytes to read.  If not</span>
<span class="sd">            specified, then read as many bytes as possible.</span>
<span class="sd">        :type size: int</span>
<span class="sd">        :rtype: unicode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># If linebuffer is not empty, then include it in the result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">:</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">chars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">chars</span></div>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.discard_line"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.discard_line">[docs]</a>    <span class="k">def</span> <span class="nf">discard_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span></div>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.readline"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.readline">[docs]</a>    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a line of text, decode it using this reader&#39;s encoding,</span>
<span class="sd">        and return the resulting unicode string.</span>

<span class="sd">        :param size: The maximum number of bytes to read.  If no</span>
<span class="sd">            newline is encountered before ``size`` bytes have been read,</span>
<span class="sd">            then the returned value may not be a complete line of text.</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we have a non-empty linebuffer, then return the first</span>
        <span class="c1"># line from it.  (Note that the last element of linebuffer may</span>
        <span class="c1"># not be a complete line; so let _read() deal with it.)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">line</span>

        <span class="n">readsize</span> <span class="o">=</span> <span class="n">size</span> <span class="ow">or</span> <span class="mi">72</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># If there&#39;s a remaining incomplete line in the buffer, add it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">:</span>
            <span class="n">chars</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span><span class="p">)</span>
            <span class="n">new_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">readsize</span><span class="p">)</span>

            <span class="c1"># If we&#39;re at a &#39;\r&#39;, then read one extra character, since</span>
            <span class="c1"># it might be a &#39;\n&#39;, to get the proper line ending.</span>
            <span class="k">if</span> <span class="n">new_chars</span> <span class="ow">and</span> <span class="n">new_chars</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">new_chars</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">chars</span> <span class="o">+=</span> <span class="n">new_chars</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">chars</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_chars</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_checkpoint</span> <span class="o">=</span> <span class="n">startpos</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">line0withend</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">line0withoutend</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">line0withend</span> <span class="o">!=</span> <span class="n">line0withoutend</span><span class="p">:</span>  <span class="c1"># complete line</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line0withend</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_chars</span> <span class="ow">or</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">chars</span>
                <span class="k">break</span>

            <span class="c1"># Read successively larger blocks of text.</span>
            <span class="k">if</span> <span class="n">readsize</span> <span class="o">&lt;</span> <span class="mi">8000</span><span class="p">:</span>
                <span class="n">readsize</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.readlines"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.readlines">[docs]</a>    <span class="k">def</span> <span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sizehint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read this file&#39;s contents, decode them using this reader&#39;s</span>
<span class="sd">        encoding, and return it as a list of unicode lines.</span>

<span class="sd">        :rtype: list(unicode)</span>
<span class="sd">        :param sizehint: Ignored.</span>
<span class="sd">        :param keepends: If false, then strip newlines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="p">)</span></div>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.next"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the next decoded line from the underlying stream.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span></div>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return self&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># let garbage collector deal with still opened streams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.xreadlines"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.xreadlines">[docs]</a>    <span class="k">def</span> <span class="nf">xreadlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return self&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Pass-through methods &amp; properties</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if the underlying stream is closed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">closed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of the underlying stream.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The mode of the underlying stream.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">mode</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.close"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the underlying stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Seek and tell</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.seek"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.seek">[docs]</a>    <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the stream to a new file position.  If the reader is</span>
<span class="sd">        maintaining any buffers, then they will be cleared.</span>

<span class="sd">        :param offset: A byte count offset.</span>
<span class="sd">        :param whence: If 0, then the offset is from the start of the file</span>
<span class="sd">            (offset should be positive), if 1, then the offset is from the</span>
<span class="sd">            current position (offset may be positive or negative); and if 2,</span>
<span class="sd">            then the offset is from the end of the file (offset should</span>
<span class="sd">            typically be negative).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Relative seek is not supported for &quot;</span>
                <span class="s2">&quot;SeekableUnicodeStreamReader -- consider &quot;</span>
                <span class="s2">&quot;using char_seek_forward() instead.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_checkpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span></div>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.char_seek_forward"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.char_seek_forward">[docs]</a>    <span class="k">def</span> <span class="nf">char_seek_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the read pointer forward by ``offset`` characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative offsets are not supported&quot;</span><span class="p">)</span>
        <span class="c1"># Clear all buffers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
        <span class="c1"># Perform the seek operation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_char_seek_forward</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_char_seek_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">est_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the file position forward by ``offset`` characters,</span>
<span class="sd">        ignoring all buffers.</span>

<span class="sd">        :param est_bytes: A hint, giving an estimate of the number of</span>
<span class="sd">            bytes that will be needed to move forward by ``offset`` chars.</span>
<span class="sd">            Defaults to ``offset``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">est_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">est_bytes</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Read in a block of bytes.</span>
            <span class="n">newbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">est_bytes</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">))</span>
            <span class="nb">bytes</span> <span class="o">+=</span> <span class="n">newbytes</span>

            <span class="c1"># Decode the bytes to characters.</span>
            <span class="n">chars</span><span class="p">,</span> <span class="n">bytes_decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incr_decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>

            <span class="c1"># If we got the right number of characters, then seek</span>
            <span class="c1"># backwards over any truncated characters, and return.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">==</span> <span class="n">offset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">+</span> <span class="n">bytes_decoded</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># If we went too far, then we can back-up until we get it</span>
            <span class="c1"># right, using the bytes we&#39;ve already read.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">offset</span><span class="p">:</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">offset</span><span class="p">:</span>
                    <span class="c1"># Assume at least one byte/char.</span>
                    <span class="n">est_bytes</span> <span class="o">+=</span> <span class="n">offset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
                    <span class="n">chars</span><span class="p">,</span> <span class="n">bytes_decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incr_decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">[:</span><span class="n">est_bytes</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">+</span> <span class="n">bytes_decoded</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Otherwise, we haven&#39;t read enough bytes yet; loop again.</span>
            <span class="n">est_bytes</span> <span class="o">+=</span> <span class="n">offset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>

<div class="viewcode-block" id="SeekableUnicodeStreamReader.tell"><a class="viewcode-back" href="../../api/nltk.data.html#nltk.data.SeekableUnicodeStreamReader.tell">[docs]</a>    <span class="k">def</span> <span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the current file position on the underlying byte</span>
<span class="sd">        stream.  If this reader is maintaining any buffers, then the</span>
<span class="sd">        returned file position will be the position of the beginning</span>
<span class="sd">        of those buffers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If nothing&#39;s buffered, then just return our current filepos:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span><span class="p">)</span>

        <span class="c1"># Otherwise, we&#39;ll need to backtrack the filepos until we</span>
        <span class="c1"># reach the beginning of the buffer.</span>

        <span class="c1"># Store our original file position, so we can return here.</span>
        <span class="n">orig_filepos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="c1"># Calculate an estimate of where we think the newline is.</span>
        <span class="n">bytes_read</span> <span class="o">=</span> <span class="p">(</span><span class="n">orig_filepos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_checkpoint</span>
        <span class="n">buf_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">)</span>
        <span class="n">est_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">bytes_read</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span> <span class="o">+</span> <span class="n">buf_size</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rewind_checkpoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_char_seek_forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rewind_numchars</span><span class="p">,</span> <span class="n">est_bytes</span><span class="p">)</span>
        <span class="n">filepos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="c1"># Sanity check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">filepos</span><span class="p">)</span>
            <span class="n">check1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incr_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">50</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">check2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linebuffer</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">check1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">check2</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">check1</span><span class="p">)</span>

        <span class="c1"># Return to our original filepos (so we don&#39;t have to throw</span>
        <span class="c1"># out our buffer.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">orig_filepos</span><span class="p">)</span>

        <span class="c1"># Return the calculated filepos</span>
        <span class="k">return</span> <span class="n">filepos</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Helper methods</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read up to ``size`` bytes from the underlying stream, decode</span>
<span class="sd">        them using this reader&#39;s encoding, and return the resulting</span>
<span class="sd">        unicode string.  ``linebuffer`` is not included in the result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Skip past the byte order marker, if present.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bom</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bom</span><span class="p">)</span>

        <span class="c1"># Read the requested number of bytes.</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span> <span class="o">+</span> <span class="n">new_bytes</span>

        <span class="c1"># Decode the bytes into unicode characters</span>
        <span class="n">chars</span><span class="p">,</span> <span class="n">bytes_decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incr_decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>

        <span class="c1"># If we got bytes but couldn&#39;t decode any, then read further.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">chars</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_bytes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">chars</span><span class="p">:</span>
                <span class="n">new_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_bytes</span><span class="p">:</span>
                    <span class="k">break</span>  <span class="c1"># end of file.</span>
                <span class="nb">bytes</span> <span class="o">+=</span> <span class="n">new_bytes</span>
                <span class="n">chars</span><span class="p">,</span> <span class="n">bytes_decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incr_decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>

        <span class="c1"># Record any bytes we didn&#39;t consume.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytebuffer</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="n">bytes_decoded</span><span class="p">:]</span>

        <span class="c1"># Return the result</span>
        <span class="k">return</span> <span class="n">chars</span>

    <span class="k">def</span> <span class="nf">_incr_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode the given byte string into a unicode string, using this</span>
<span class="sd">        reader&#39;s encoding.  If an exception is encountered that</span>
<span class="sd">        appears to be caused by a truncation error, then just decode</span>
<span class="sd">        the byte string without the bytes that cause the trunctaion</span>
<span class="sd">        error.</span>

<span class="sd">        Return a tuple ``(chars, num_consumed)``, where ``chars`` is</span>
<span class="sd">        the decoded unicode string, and ``num_consumed`` is the</span>
<span class="sd">        number of bytes that were consumed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c1"># If the exception occurs at the end of the string,</span>
                <span class="c1"># then assume that it&#39;s a truncation error.</span>
                <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">[:</span> <span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

                <span class="c1"># Otherwise, if we&#39;re being strict, then raise it.</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">==</span> <span class="s2">&quot;strict&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>

                <span class="c1"># If we&#39;re not strict, then re-process it with our</span>
                <span class="c1"># errors setting.  This *may* raise an exception.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

    <span class="n">_BOM_TABLE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;utf8&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF8</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
        <span class="s2">&quot;utf16&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_LE</span><span class="p">,</span> <span class="s2">&quot;utf16-le&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_BE</span><span class="p">,</span> <span class="s2">&quot;utf16-be&quot;</span><span class="p">)],</span>
        <span class="s2">&quot;utf16le&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_LE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
        <span class="s2">&quot;utf16be&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_BE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
        <span class="s2">&quot;utf32&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_LE</span><span class="p">,</span> <span class="s2">&quot;utf32-le&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_BE</span><span class="p">,</span> <span class="s2">&quot;utf32-be&quot;</span><span class="p">)],</span>
        <span class="s2">&quot;utf32le&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_LE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
        <span class="s2">&quot;utf32be&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_BE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_check_bom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Normalize our encoding name</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[ -]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># Look up our encoding in the BOM table.</span>
        <span class="n">bom_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BOM_TABLE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bom_info</span><span class="p">:</span>
            <span class="c1"># Read a prefix, to check against the BOM(s)</span>
            <span class="nb">bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Check for each possible BOM.</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">bom</span><span class="p">,</span> <span class="n">new_encoding</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bom_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">bom</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">new_encoding</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">new_encoding</span>
                    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">bom</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PathPointer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FileSystemPathPointer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BufferedGzipFile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GzipFileSystemPathPointer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GzipFileSystemPathPointer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;find&quot;</span><span class="p">,</span>
    <span class="s2">&quot;retrieve&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FORMATS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AUTO_FORMATS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;load&quot;</span><span class="p">,</span>
    <span class="s2">&quot;show_cfg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;clear_cache&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LazyLoader&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OpenOnDemandZipFile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GzipFileSystemPathPointer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SeekableUnicodeStreamReader&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

        </div>
      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            

            
                <li class="footer-element">
                    <a href="https://github.com/nltk/nltk/tree/3.8.1">3.8.1</a>
                </li>
            

            
                <li class="footer-element">
                    Jan 02, 2023
                </li>
            
        </ul>

        
            <div id="copyright">
                &copy; 2023, NLTK Project
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/tomaarsen/nltk_theme">NLTK Theme</a>
        </div>
    </div>
</footer> 

</div>

</body>
</html>
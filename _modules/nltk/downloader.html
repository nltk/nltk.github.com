<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>NLTK :: nltk.downloader</title>
  

  <link rel="stylesheet" href="../../_static/css/nltk_theme.css"/>
  <link rel="stylesheet" href="../../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="nltk-theme-container">
    <header>
      <div id="logo-container">
          
          <h1>
            <a href="../../index.html">NLTK</a>
          </h1>
          
      </div>
      <div id="project-container">
        
        <h1>Documentation</h1>
        
      </div>

      <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

      <script type="text/javascript">
        $("#menu-toggle").click(function() {
          $("#menu-toggle").toggleClass("toggled");
          $("#side-menu-container").slideToggle(300);
        });
      </script>
    </header>

    <div id="content-container">

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">
          
  
    
  
  
    <p class="caption" role="heading"><span class="caption-text">NLTK Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/nltk.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto.html">Example Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki">Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki/FAQ">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/issues">Open Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk">NLTK on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installing NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">Installing NLTK Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../news.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing to NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../team.html">NLTK Team</a></li>
</ul>

  

        </div>

        
      </div>

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <h1>Source code for nltk.downloader</h1><div class="highlight"><pre>
<span></span><span class="c1"># Natural Language Toolkit: Corpus &amp; Model Downloader</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2023 NLTK Project</span>
<span class="c1"># Author: Edward Loper &lt;edloper@gmail.com&gt;</span>
<span class="c1"># URL: &lt;https://www.nltk.org/&gt;</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The NLTK corpus and module downloader.  This module defines several</span>
<span class="sd">interfaces which can be used to download corpora, models, and other</span>
<span class="sd">data packages that can be used with NLTK.</span>

<span class="sd">Downloading Packages</span>
<span class="sd">====================</span>
<span class="sd">If called with no arguments, ``download()`` will display an interactive</span>
<span class="sd">interface which can be used to download and install new packages.</span>
<span class="sd">If Tkinter is available, then a graphical interface will be shown,</span>
<span class="sd">otherwise a simple text interface will be provided.</span>

<span class="sd">Individual packages can be downloaded by calling the ``download()``</span>
<span class="sd">function with a single argument, giving the package identifier for the</span>
<span class="sd">package that should be downloaded:</span>

<span class="sd">    &gt;&gt;&gt; download(&#39;treebank&#39;) # doctest: +SKIP</span>
<span class="sd">    [nltk_data] Downloading package &#39;treebank&#39;...</span>
<span class="sd">    [nltk_data]   Unzipping corpora/treebank.zip.</span>

<span class="sd">NLTK also provides a number of \&quot;package collections\&quot;, consisting of</span>
<span class="sd">a group of related packages.  To download all packages in a</span>
<span class="sd">colleciton, simply call ``download()`` with the collection&#39;s</span>
<span class="sd">identifier:</span>

<span class="sd">    &gt;&gt;&gt; download(&#39;all-corpora&#39;) # doctest: +SKIP</span>
<span class="sd">    [nltk_data] Downloading package &#39;abc&#39;...</span>
<span class="sd">    [nltk_data]   Unzipping corpora/abc.zip.</span>
<span class="sd">    [nltk_data] Downloading package &#39;alpino&#39;...</span>
<span class="sd">    [nltk_data]   Unzipping corpora/alpino.zip.</span>
<span class="sd">      ...</span>
<span class="sd">    [nltk_data] Downloading package &#39;words&#39;...</span>
<span class="sd">    [nltk_data]   Unzipping corpora/words.zip.</span>

<span class="sd">Download Directory</span>
<span class="sd">==================</span>
<span class="sd">By default, packages are installed in either a system-wide directory</span>
<span class="sd">(if Python has sufficient access to write to it); or in the current</span>
<span class="sd">user&#39;s home directory.  However, the ``download_dir`` argument may be</span>
<span class="sd">used to specify a different installation target, if desired.</span>

<span class="sd">See ``Downloader.default_download_dir()`` for more a detailed</span>
<span class="sd">description of how the default download directory is chosen.</span>

<span class="sd">NLTK Download Server</span>
<span class="sd">====================</span>
<span class="sd">Before downloading any packages, the corpus and module downloader</span>
<span class="sd">contacts the NLTK download server, to retrieve an index file</span>
<span class="sd">describing the available packages.  By default, this index file is</span>
<span class="sd">loaded from ``https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/index.xml``.</span>
<span class="sd">If necessary, it is possible to create a new ``Downloader`` object,</span>
<span class="sd">specifying a different URL for the package index file.</span>

<span class="sd">Usage::</span>

<span class="sd">    python nltk/downloader.py [-d DATADIR] [-q] [-f] [-k] PACKAGE_IDS</span>

<span class="sd">or::</span>

<span class="sd">    python -m nltk.downloader [-d DATADIR] [-q] [-f] [-k] PACKAGE_IDS</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">  0     1  2    3</span>
<span class="sd">[label][----][label][----]</span>
<span class="sd">[column  ][column     ]</span>

<span class="sd">Notes</span>
<span class="sd">=====</span>
<span class="sd">Handling data files..  Some questions:</span>

<span class="sd">* Should the data files be kept zipped or unzipped?  I say zipped.</span>

<span class="sd">* Should the data files be kept in svn at all?  Advantages: history;</span>
<span class="sd">  automatic version numbers; &#39;svn up&#39; could be used rather than the</span>
<span class="sd">  downloader to update the corpora.  Disadvantages: they&#39;re big,</span>
<span class="sd">  which makes working from svn a bit of a pain.  And we&#39;re planning</span>
<span class="sd">  to potentially make them much bigger.  I don&#39;t think we want</span>
<span class="sd">  people to have to download 400MB corpora just to use nltk from svn.</span>

<span class="sd">* Compromise: keep the data files in trunk/data rather than in</span>
<span class="sd">  trunk/nltk.  That way you can check them out in svn if you want</span>
<span class="sd">  to; but you don&#39;t need to, and you can use the downloader instead.</span>

<span class="sd">* Also: keep models in mind.  When we change the code, we&#39;d</span>
<span class="sd">  potentially like the models to get updated.  This could require a</span>
<span class="sd">  little thought.</span>

<span class="sd">* So.. let&#39;s assume we have a trunk/data directory, containing a bunch</span>
<span class="sd">  of packages.  The packages should be kept as zip files, because we</span>
<span class="sd">  really shouldn&#39;t be editing them much (well -- we may edit models</span>
<span class="sd">  more, but they tend to be binary-ish files anyway, where diffs</span>
<span class="sd">  aren&#39;t that helpful).  So we&#39;ll have trunk/data, with a bunch of</span>
<span class="sd">  files like abc.zip and treebank.zip and propbank.zip.  For each</span>
<span class="sd">  package we could also have eg treebank.xml and propbank.xml,</span>
<span class="sd">  describing the contents of the package (name, copyright, license,</span>
<span class="sd">  etc).  Collections would also have .xml files.  Finally, we would</span>
<span class="sd">  pull all these together to form a single index.xml file.  Some</span>
<span class="sd">  directory structure wouldn&#39;t hurt.  So how about::</span>

<span class="sd">    /trunk/data/ ....................... root of data svn</span>
<span class="sd">      index.xml ........................ main index file</span>
<span class="sd">      src/ ............................. python scripts</span>
<span class="sd">      packages/ ........................ dir for packages</span>
<span class="sd">        corpora/ ....................... zip &amp; xml files for corpora</span>
<span class="sd">        grammars/ ...................... zip &amp; xml files for grammars</span>
<span class="sd">        taggers/ ....................... zip &amp; xml files for taggers</span>
<span class="sd">        tokenizers/ .................... zip &amp; xml files for tokenizers</span>
<span class="sd">        etc.</span>
<span class="sd">      collections/ ..................... xml files for collections</span>

<span class="sd">  Where the root (/trunk/data) would contain a makefile; and src/</span>
<span class="sd">  would contain a script to update the info.xml file.  It could also</span>
<span class="sd">  contain scripts to rebuild some of the various model files.  The</span>
<span class="sd">  script that builds index.xml should probably check that each zip</span>
<span class="sd">  file expands entirely into a single subdir, whose name matches the</span>
<span class="sd">  package&#39;s uid.</span>

<span class="sd">Changes I need to make:</span>
<span class="sd">  - in index: change &quot;size&quot; to &quot;filesize&quot; or &quot;compressed-size&quot;</span>
<span class="sd">  - in index: add &quot;unzipped-size&quot;</span>
<span class="sd">  - when checking status: check both compressed &amp; uncompressed size.</span>
<span class="sd">    uncompressed size is important to make sure we detect a problem</span>
<span class="sd">    if something got partially unzipped.  define new status values</span>
<span class="sd">    to differentiate stale vs corrupt vs corruptly-uncompressed??</span>
<span class="sd">    (we shouldn&#39;t need to re-download the file if the zip file is ok</span>
<span class="sd">    but it didn&#39;t get uncompressed fully.)</span>
<span class="sd">  - add other fields to the index: author, license, copyright, contact,</span>
<span class="sd">    etc.</span>

<span class="sd">the current grammars/ package would become a single new package (eg</span>
<span class="sd">toy-grammars or book-grammars).</span>

<span class="sd">xml file should have:</span>
<span class="sd">  - authorship info</span>
<span class="sd">  - license info</span>
<span class="sd">  - copyright info</span>
<span class="sd">  - contact info</span>
<span class="sd">  - info about what type of data/annotation it contains?</span>
<span class="sd">  - recommended corpus reader?</span>

<span class="sd">collections can contain other collections.  they can also contain</span>
<span class="sd">multiple package types (corpora &amp; models).  Have a single &#39;basics&#39;</span>
<span class="sd">package that includes everything we talk about in the book?</span>

<span class="sd">n.b.: there will have to be a fallback to the punkt tokenizer, in case</span>
<span class="sd">they didn&#39;t download that model.</span>

<span class="sd">default: unzip or not?</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">TKINTER</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Canvas</span><span class="p">,</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">Frame</span><span class="p">,</span> <span class="n">IntVar</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">TclError</span><span class="p">,</span> <span class="n">Tk</span>
    <span class="kn">from</span> <span class="nn">tkinter.messagebox</span> <span class="kn">import</span> <span class="n">showerror</span>

    <span class="kn">from</span> <span class="nn">nltk.draw.table</span> <span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span> <span class="nn">nltk.draw.util</span> <span class="kn">import</span> <span class="n">ShowText</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">TKINTER</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">TclError</span> <span class="o">=</span> <span class="ne">ValueError</span>

<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="kn">import</span> <span class="nn">nltk</span>

<span class="c1"># urllib2 = nltk.internals.import_from_stdlib(&#39;urllib2&#39;)</span>


<span class="c1">######################################################################</span>
<span class="c1"># Directory entry objects (from the data server&#39;s index file)</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="Package"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Package">[docs]</a><span class="k">class</span> <span class="nc">Package</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A directory entry for a downloadable package.  These entries are</span>
<span class="sd">    extracted from the XML index file that is downloaded by</span>
<span class="sd">    ``Downloader``.  Each package consists of a single file; but if</span>
<span class="sd">    that file is a zip file, then it can be automatically decompressed</span>
<span class="sd">    when the package is installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Package.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Package.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">subdir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">unzipped_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">checksum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">svn_revision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">copyright</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">contact</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="sd">&quot;&quot;&quot;A unique identifier for this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="nb">id</span>
        <span class="sd">&quot;&quot;&quot;A string name for this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="n">subdir</span>
        <span class="sd">&quot;&quot;&quot;The subdirectory where this package should be installed.</span>
<span class="sd">           E.g., ``&#39;corpora&#39;`` or ``&#39;taggers&#39;``.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="sd">&quot;&quot;&quot;A URL that can be used to download this package&#39;s file.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The filesize (in bytes) of the package file.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unzipped_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unzipped_size</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The total filesize of the files contained in the package&#39;s</span>
<span class="sd">           zipfile.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">checksum</span>
        <span class="sd">&quot;&quot;&quot;The MD-5 checksum of the package file.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svn_revision</span> <span class="o">=</span> <span class="n">svn_revision</span>
        <span class="sd">&quot;&quot;&quot;A subversion revision number for this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copyright</span> <span class="o">=</span> <span class="n">copyright</span>
        <span class="sd">&quot;&quot;&quot;Copyright holder for this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contact</span> <span class="o">=</span> <span class="n">contact</span>
        <span class="sd">&quot;&quot;&quot;Name &amp; email of the person who should be contacted with</span>
<span class="sd">           questions about this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">license</span>
        <span class="sd">&quot;&quot;&quot;License information for this package.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
        <span class="sd">&quot;&quot;&quot;Author of this package.&quot;&quot;&quot;</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="nb">id</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The filename that should be used for this package&#39;s file.  It</span>
<span class="sd">           is formed by joining ``self.subdir`` with ``self.id``, and</span>
<span class="sd">           using the same extension as ``url``.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unzip</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">unzip</span><span class="p">))</span>  <span class="c1"># &#39;0&#39; or &#39;1&#39;</span>
        <span class="sd">&quot;&quot;&quot;A flag indicating whether this corpus should be unzipped by</span>
<span class="sd">           default.&quot;&quot;&quot;</span>

        <span class="c1"># Include any other attributes provided by the XML file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Package.fromxml"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Package.fromxml">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromxml</span><span class="p">(</span><span class="n">xml</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xml</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Package</span><span class="p">(</span><span class="o">**</span><span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Package </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span></div>


<div class="viewcode-block" id="Collection"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Collection">[docs]</a><span class="k">class</span> <span class="nc">Collection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A directory entry for a collection of downloadable packages.</span>
<span class="sd">    These entries are extracted from the XML index file that is</span>
<span class="sd">    downloaded by ``Downloader``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Collection.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Collection.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="sd">&quot;&quot;&quot;A unique identifier for this collection.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="nb">id</span>
        <span class="sd">&quot;&quot;&quot;A string name for this collection.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">children</span>
        <span class="sd">&quot;&quot;&quot;A list of the ``Collections`` or ``Packages`` directly</span>
<span class="sd">           contained by this collection.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;A list of ``Packages`` contained by this collection or any</span>
<span class="sd">           collections it recursively contains.&quot;&quot;&quot;</span>

        <span class="c1"># Include any other attributes provided by the XML file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Collection.fromxml"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Collection.fromxml">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromxml</span><span class="p">(</span><span class="n">xml</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xml</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ref&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">Collection</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Collection </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Message Passing Objects</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="DownloaderMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderMessage">[docs]</a><span class="k">class</span> <span class="nc">DownloaderMessage</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A status message object, used by ``incr_download`` to</span>
<span class="sd">    communicate its progress.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="StartCollectionMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartCollectionMessage">[docs]</a><span class="k">class</span> <span class="nc">StartCollectionMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has started working on a collection of packages.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StartCollectionMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartCollectionMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span></div></div>


<div class="viewcode-block" id="FinishCollectionMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishCollectionMessage">[docs]</a><span class="k">class</span> <span class="nc">FinishCollectionMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has finished working on a collection of packages.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FinishCollectionMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishCollectionMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span></div></div>


<div class="viewcode-block" id="StartPackageMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartPackageMessage">[docs]</a><span class="k">class</span> <span class="nc">StartPackageMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has started working on a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StartPackageMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartPackageMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="FinishPackageMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishPackageMessage">[docs]</a><span class="k">class</span> <span class="nc">FinishPackageMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has finished working on a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FinishPackageMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishPackageMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="StartDownloadMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartDownloadMessage">[docs]</a><span class="k">class</span> <span class="nc">StartDownloadMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has started downloading a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StartDownloadMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartDownloadMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="FinishDownloadMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishDownloadMessage">[docs]</a><span class="k">class</span> <span class="nc">FinishDownloadMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has finished downloading a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FinishDownloadMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishDownloadMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="StartUnzipMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartUnzipMessage">[docs]</a><span class="k">class</span> <span class="nc">StartUnzipMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has started unzipping a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StartUnzipMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StartUnzipMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="FinishUnzipMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishUnzipMessage">[docs]</a><span class="k">class</span> <span class="nc">FinishUnzipMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server has finished unzipping a package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FinishUnzipMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.FinishUnzipMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="UpToDateMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.UpToDateMessage">[docs]</a><span class="k">class</span> <span class="nc">UpToDateMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The package download file is already up-to-date&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UpToDateMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.UpToDateMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="StaleMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StaleMessage">[docs]</a><span class="k">class</span> <span class="nc">StaleMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The package download file is out-of-date or corrupt&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StaleMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.StaleMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span></div></div>


<div class="viewcode-block" id="ErrorMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.ErrorMessage">[docs]</a><span class="k">class</span> <span class="nc">ErrorMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data server encountered an error&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ErrorMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.ErrorMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">package</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span></div></div>


<div class="viewcode-block" id="ProgressMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.ProgressMessage">[docs]</a><span class="k">class</span> <span class="nc">ProgressMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates how much progress the data server has made&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ProgressMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.ProgressMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span></div></div>


<div class="viewcode-block" id="SelectDownloadDirMessage"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.SelectDownloadDirMessage">[docs]</a><span class="k">class</span> <span class="nc">SelectDownloadDirMessage</span><span class="p">(</span><span class="n">DownloaderMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates what download directory the data server is using&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SelectDownloadDirMessage.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.SelectDownloadDirMessage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">download_dir</span></div></div>


<span class="c1">######################################################################</span>
<span class="c1"># NLTK Data Server</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="Downloader"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader">[docs]</a><span class="k">class</span> <span class="nc">Downloader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class used to access the NLTK data server, which can be used to</span>
<span class="sd">    download corpora and other data packages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Configuration</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">INDEX_TIMEOUT</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># 1 hour</span>
    <span class="sd">&quot;&quot;&quot;The amount of time after which the cached copy of the data</span>
<span class="sd">       server index will be considered &#39;stale,&#39; and will be</span>
<span class="sd">       re-downloaded.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/index.xml&quot;</span>
    <span class="sd">&quot;&quot;&quot;The default URL for the NLTK data server&#39;s index.  An</span>
<span class="sd">       alternative URL can be specified when creating a new</span>
<span class="sd">       ``Downloader`` object.&quot;&quot;&quot;</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Status Constants</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">INSTALLED</span> <span class="o">=</span> <span class="s2">&quot;installed&quot;</span>
    <span class="sd">&quot;&quot;&quot;A status string indicating that a package or collection is</span>
<span class="sd">       installed and up-to-date.&quot;&quot;&quot;</span>
    <span class="n">NOT_INSTALLED</span> <span class="o">=</span> <span class="s2">&quot;not installed&quot;</span>
    <span class="sd">&quot;&quot;&quot;A status string indicating that a package or collection is</span>
<span class="sd">       not installed.&quot;&quot;&quot;</span>
    <span class="n">STALE</span> <span class="o">=</span> <span class="s2">&quot;out of date&quot;</span>
    <span class="sd">&quot;&quot;&quot;A status string indicating that a package or collection is</span>
<span class="sd">       corrupt or out-of-date.&quot;&quot;&quot;</span>
    <span class="n">PARTIAL</span> <span class="o">=</span> <span class="s2">&quot;partial&quot;</span>
    <span class="sd">&quot;&quot;&quot;A status string indicating that a collection is partially</span>
<span class="sd">       installed (i.e., only some of its packages are installed.)&quot;&quot;&quot;</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Constructor</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="Downloader.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_index_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">server_index_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_URL</span>
        <span class="sd">&quot;&quot;&quot;The URL for the data server&#39;s index file.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dictionary from collection identifier to ``Collection``&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dictionary from package identifier to ``Package``&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>
        <span class="sd">&quot;&quot;&quot;The default directory to which packages will be downloaded.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;The XML index file downloaded from the data server&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;Time at which ``self._index`` was downloaded.  If it is more</span>
<span class="sd">           than ``INDEX_TIMEOUT`` seconds old, it will be re-downloaded.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dictionary from package/collection identifier to status</span>
<span class="sd">           string (``INSTALLED``, ``NOT_INSTALLED``, ``STALE``, or</span>
<span class="sd">           ``PARTIAL``).  Cache is used for packages only, not</span>
<span class="sd">           collections.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;Flag for telling if all packages got successfully downloaded or not.&quot;&quot;&quot;</span>

        <span class="c1"># decide where we&#39;re going to save things to.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_download_dir</span><span class="p">()</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Information</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="Downloader.list"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_packages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show_collections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">more_prompt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_installed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for more_prompt</span>
        <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">download_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using default data directory (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">download_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">26</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Data server index for &lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">26</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)))</span>
            <span class="n">lines</span> <span class="o">+=</span> <span class="mi">3</span>  <span class="c1"># for more_prompt</span>
        <span class="n">stale</span> <span class="o">=</span> <span class="n">partial</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">show_packages</span><span class="p">:</span>
            <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;packages&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_collections</span><span class="p">:</span>
            <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;collections&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="n">category</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="n">lines</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># for more_prompt</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">)(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span> <span class="ow">and</span> <span class="n">skip_installed</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span>
                    <span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARTIAL</span><span class="p">:</span>
                    <span class="n">partial</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PARTIAL</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="p">}[</span><span class="n">status</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                    <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">27</span> <span class="o">+</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="mi">75</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="mi">27</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
                <span class="p">)[</span><span class="mi">27</span><span class="p">:]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [</span><span class="si">{}</span><span class="s2">] </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="n">name</span><span class="p">))</span>
                <span class="n">lines</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>  <span class="c1"># for more_prompt</span>
                <span class="k">if</span> <span class="n">more_prompt</span> <span class="ow">and</span> <span class="n">lines</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Hit Enter to continue: &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">):</span>
                        <span class="k">return</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;([*] marks installed packages&quot;</span>
        <span class="k">if</span> <span class="n">stale</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;; [-] marks out-of-date or corrupt packages&quot;</span>
        <span class="k">if</span> <span class="n">partial</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;; [P] marks partially installed collections&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">76</span><span class="p">))</span></div>

<div class="viewcode-block" id="Downloader.packages"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.packages">[docs]</a>    <span class="k">def</span> <span class="nf">packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="Downloader.corpora"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.corpora">[docs]</a>    <span class="k">def</span> <span class="nf">corpora</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pkg</span> <span class="k">for</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">pkg</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">pkg</span><span class="o">.</span><span class="n">subdir</span> <span class="o">==</span> <span class="s2">&quot;corpora&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Downloader.models"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.models">[docs]</a>    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pkg</span> <span class="k">for</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">pkg</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">pkg</span><span class="o">.</span><span class="n">subdir</span> <span class="o">!=</span> <span class="s2">&quot;corpora&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Downloader.collections"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.collections">[docs]</a>    <span class="k">def</span> <span class="nf">collections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Downloading</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_info_or_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_or_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">info_or_id</span>

    <span class="c1"># [xx] When during downloading is it &#39;safe&#39; to abort?  Only unsafe</span>
    <span class="c1"># time is *during* an unzip -- we don&#39;t want to leave a</span>
    <span class="c1"># partially-unzipped corpus in place because we wouldn&#39;t notice</span>
    <span class="c1"># it.  But if we had the exact total size of the unzipped corpus,</span>
    <span class="c1"># then that would be fine.  Then we could abort anytime we want!</span>
    <span class="c1"># So this is really what we should do.  That way the threaded</span>
    <span class="c1"># downloader in the gui can just kill the download thread anytime</span>
    <span class="c1"># it wants.</span>

<div class="viewcode-block" id="Downloader.incr_download"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.incr_download">[docs]</a>    <span class="k">def</span> <span class="nf">incr_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># If they didn&#39;t specify a download_dir, then use the default one.</span>
        <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">download_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span>
            <span class="k">yield</span> <span class="n">SelectDownloadDirMessage</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>

        <span class="c1"># If they gave us a list of ids, then download each one.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_list</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Look up the requested collection or package.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_or_id</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ErrorMessage</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error loading </span><span class="si">{</span><span class="n">info_or_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Handle collections.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">StartCollectionMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">incr_download</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">FinishCollectionMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

        <span class="c1"># Handle Packages (delegate to a helper function).</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_package</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_num_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Package</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="c1"># Look up the requested items.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_or_id</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">ErrorMessage</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Download each item, re-scaling their progress.</span>
        <span class="n">num_packages</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_packages</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Package</span><span class="p">):</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">num_packages</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_packages</span>
            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incr_download</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ProgressMessage</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="n">progress</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">progress</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">msg</span>

            <span class="n">progress</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">delta</span>

    <span class="k">def</span> <span class="nf">_download_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">StartPackageMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Do we already have the current version?</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">UpToDateMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">FinishPackageMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Remove the package from our status cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Check for (and remove) any old/stale version.</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">StaleMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Ensure the download_dir exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">subdir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">subdir</span><span class="p">))</span>

        <span class="c1"># Download the file.  This will raise an IOError if the url</span>
        <span class="c1"># is not found.</span>
        <span class="k">yield</span> <span class="n">StartDownloadMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># 16k blocks.</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">block</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># how often?</span>
                        <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">75</span> <span class="o">*</span> <span class="p">(</span><span class="n">block</span> <span class="o">/</span> <span class="n">num_blocks</span><span class="p">)))</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ErrorMessage</span><span class="p">(</span>
                <span class="n">info</span><span class="p">,</span>
                <span class="s2">&quot;Error downloading </span><span class="si">%r</span><span class="s2"> from &lt;</span><span class="si">%s</span><span class="s2">&gt;:&quot;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">yield</span> <span class="n">FinishDownloadMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">ProgressMessage</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>

        <span class="c1"># If it&#39;s a zipfile, uncompress it.</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
            <span class="n">zipdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">subdir</span><span class="p">)</span>
            <span class="c1"># Unzip if we&#39;re unzipping by default; *or* if it&#39;s already</span>
            <span class="c1"># been unzipped (presumably a previous version).</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">unzip</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">StartUnzipMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">_unzip_iter</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">zipdir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="c1"># Somewhat of a hack, but we need a proper package reference</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">info</span>
                    <span class="k">yield</span> <span class="n">msg</span>
                <span class="k">yield</span> <span class="n">FinishUnzipMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">FinishPackageMessage</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

<div class="viewcode-block" id="Downloader.download"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.download">[docs]</a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">info_or_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;[nltk_data] &quot;</span><span class="p">,</span>
        <span class="n">halt_on_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">print_error_to</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">print_to</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">print_error_to</span><span class="p">)</span>
        <span class="c1"># If no info or id is given, then use the interactive shell.</span>
        <span class="k">if</span> <span class="n">info_or_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># [xx] hmm -- changing self._download_dir here seems like</span>
            <span class="c1"># the wrong thing to do.  Maybe the _interactive_download</span>
            <span class="c1"># function should make a new copy of self to use?</span>
            <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_download</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define a helper function for displaying output:</span>
            <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prefix2</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="n">print_to</span><span class="p">(</span>
                    <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                        <span class="n">s</span><span class="p">,</span>
                        <span class="n">initial_indent</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">prefix2</span><span class="p">,</span>
                        <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">prefix2</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incr_download</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
                <span class="c1"># Error messages</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">):</span>
                    <span class="n">show</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">halt_on_error</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                        <span class="n">print_to</span><span class="p">(</span><span class="s2">&quot;Error installing package. Retry? [n/y/e]&quot;</span><span class="p">)</span>
                        <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
                                <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                <span class="n">download_dir</span><span class="p">,</span>
                                <span class="n">quiet</span><span class="p">,</span>
                                <span class="n">force</span><span class="p">,</span>
                                <span class="n">prefix</span><span class="p">,</span>
                                <span class="n">halt_on_error</span><span class="p">,</span>
                                <span class="n">raise_on_error</span><span class="p">,</span>
                            <span class="p">):</span>
                                <span class="k">return</span> <span class="kc">False</span>
                        <span class="k">elif</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]:</span>
                            <span class="k">return</span> <span class="kc">False</span>

                <span class="c1"># All other messages</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="c1"># Collection downloading messages:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartCollectionMessage</span><span class="p">):</span>
                        <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Downloading collection </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">prefix</span> <span class="o">+=</span> <span class="s2">&quot;   | &quot;</span>
                        <span class="n">print_to</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishCollectionMessage</span><span class="p">):</span>
                        <span class="n">print_to</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
                            <span class="n">show</span><span class="p">(</span>
                                <span class="s2">&quot;Downloaded collection </span><span class="si">%r</span><span class="s2"> with errors&quot;</span>
                                <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Done downloading collection </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                    <span class="c1"># Package downloading messages:</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartPackageMessage</span><span class="p">):</span>
                        <span class="n">show</span><span class="p">(</span>
                            <span class="s2">&quot;Downloading package </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">...&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">UpToDateMessage</span><span class="p">):</span>
                        <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%s</span><span class="s2"> is already up-to-date!&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">)</span>
                    <span class="c1"># elif isinstance(msg, StaleMessage):</span>
                    <span class="c1">#    show(&#39;Package %s is out-of-date or corrupt&#39; %</span>
                    <span class="c1">#         msg.package.id, &#39;  &#39;)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartUnzipMessage</span><span class="p">):</span>
                        <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Unzipping </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">)</span>

                    <span class="c1"># Data directory message:</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">SelectDownloadDirMessage</span><span class="p">):</span>
                        <span class="n">download_dir</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">download_dir</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Downloader.is_stale"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.is_stale">[docs]</a>    <span class="k">def</span> <span class="nf">is_stale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span></div>

<div class="viewcode-block" id="Downloader.is_installed"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.is_installed">[docs]</a>    <span class="k">def</span> <span class="nf">is_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span></div>

<div class="viewcode-block" id="Downloader.clear_status_cache"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.clear_status_cache">[docs]</a>    <span class="k">def</span> <span class="nf">clear_status_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Downloader.status"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.status">[docs]</a>    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_or_id</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a constant describing the status of the given package</span>
<span class="sd">        or collection.  Status can be one of ``INSTALLED``,</span>
<span class="sd">        ``NOT_INSTALLED``, ``STALE``, or ``PARTIAL``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">download_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_or_id</span><span class="p">(</span><span class="n">info_or_id</span><span class="p">)</span>

        <span class="c1"># Handle collections:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
            <span class="n">pkg_status</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span> <span class="ow">in</span> <span class="n">pkg_status</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARTIAL</span> <span class="ow">in</span> <span class="n">pkg_status</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARTIAL</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span> <span class="ow">in</span> <span class="n">pkg_status</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span> <span class="ow">in</span> <span class="n">pkg_status</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARTIAL</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span> <span class="ow">in</span> <span class="n">pkg_status</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span>

        <span class="c1"># Handle packages:</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">download_dir</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pkg_status</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pkg_status</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_pkg_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span>

        <span class="c1"># Check if the file has the correct size.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filestat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_INSTALLED</span>
        <span class="k">if</span> <span class="n">filestat</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span>

        <span class="c1"># Check if the file&#39;s checksum matches</span>
        <span class="k">if</span> <span class="n">md5_hexdigest</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">!=</span> <span class="n">info</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span>

        <span class="c1"># If it&#39;s a zipfile, and it&#39;s been at least partially</span>
        <span class="c1"># unzipped, then check if it&#39;s been fully unzipped.</span>
        <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
            <span class="n">unzipdir</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">unzipdir</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span>  <span class="c1"># but not unzipped -- ok!</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">unzipdir</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span>

            <span class="n">unzipped_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">st_size</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">unzipdir</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">unzipped_size</span> <span class="o">!=</span> <span class="n">info</span><span class="o">.</span><span class="n">unzipped_size</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span>

        <span class="c1"># Otherwise, everything looks good.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INSTALLED</span>

<div class="viewcode-block" id="Downloader.update"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;[nltk_data] &quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-download any packages whose status is STALE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_status_cache</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Index</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_update_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A helper function that ensures that self._index is</span>
<span class="sd">        up-to-date.  If the index is older than self.INDEX_TIMEOUT,</span>
<span class="sd">        then download it again.&quot;&quot;&quot;</span>
        <span class="c1"># Check if the index is already up-to-date.  If so, do nothing.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_timestamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDEX_TIMEOUT</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># If a URL was specified, then update our URL.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

        <span class="c1"># Download the index file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">internals</span><span class="o">.</span><span class="n">ElementWrapper</span><span class="p">(</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">))</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Build a dictionary of packages.</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">Package</span><span class="o">.</span><span class="n">fromxml</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;packages/package&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">}</span>

        <span class="c1"># Build a dictionary of collections.</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Collection</span><span class="o">.</span><span class="n">fromxml</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;collections/collection&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">}</span>

        <span class="c1"># Replace identifiers with actual children in collection.children.</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="p">:</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;removing collection member with no package: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">child_id</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">del</span> <span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Fill in collection.packages for each collection.</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">collection</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Package</span><span class="p">):</span>
                    <span class="n">packages</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="n">packages</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># Flush the status cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="Downloader.index"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the XML index describing the packages available from</span>
<span class="sd">        the data server.  If necessary, this index will be downloaded</span>
<span class="sd">        from the data server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span></div>

<div class="viewcode-block" id="Downloader.info"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the ``Package`` or ``Collection`` record for the</span>
<span class="sd">        given item.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_packages</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%r</span><span class="s2"> not found in index&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Downloader.xmlinfo"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.xmlinfo">[docs]</a>    <span class="k">def</span> <span class="nf">xmlinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the XML info record for the given item&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;packages/package&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">package</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;collections/collection&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">collection</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%r</span><span class="s2"> not found in index&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">)</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># URL &amp; Data Directory</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The URL for the data server&#39;s index file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

    <span class="k">def</span> <span class="nf">_set_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new URL for the data server. If we&#39;re unable to contact</span>
<span class="sd">        the given url, then the original url is kept.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_index</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">original_url</span>
            <span class="k">raise</span>

    <span class="n">url</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_url</span><span class="p">,</span> <span class="n">_set_url</span><span class="p">)</span>

<div class="viewcode-block" id="Downloader.default_download_dir"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.Downloader.default_download_dir">[docs]</a>    <span class="k">def</span> <span class="nf">default_download_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the directory to which packages will be downloaded by</span>
<span class="sd">        default.  This value can be overridden using the constructor,</span>
<span class="sd">        or on a case-by-case basis using the ``download_dir`` argument when</span>
<span class="sd">        calling ``download()``.</span>

<span class="sd">        On Windows, the default download directory is</span>
<span class="sd">        ``PYTHONHOME/lib/nltk``, where *PYTHONHOME* is the</span>
<span class="sd">        directory containing Python, e.g. ``C:\\Python25``.</span>

<span class="sd">        On all other platforms, the default directory is the first of</span>
<span class="sd">        the following which exists or which can be created with write</span>
<span class="sd">        permission: ``/usr/share/nltk_data``, ``/usr/local/share/nltk_data``,</span>
<span class="sd">        ``/usr/lib/nltk_data``, ``/usr/local/lib/nltk_data``, ``~/nltk_data``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if we are on GAE where we cannot write into filesystem.</span>
        <span class="k">if</span> <span class="s2">&quot;APPENGINE_RUNTIME&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check if we have sufficient permissions to install in a</span>
        <span class="c1"># variety of system-wide locations.</span>
        <span class="k">for</span> <span class="n">nltkdir</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">nltkdir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nltk</span><span class="o">.</span><span class="n">internals</span><span class="o">.</span><span class="n">is_writable</span><span class="p">(</span><span class="n">nltkdir</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">nltkdir</span>

        <span class="c1"># On Windows, use %APPDATA%</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="ow">and</span> <span class="s2">&quot;APPDATA&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">homedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;APPDATA&quot;</span><span class="p">]</span>

        <span class="c1"># Otherwise, install in the user&#39;s home directory.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">homedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">homedir</span> <span class="o">==</span> <span class="s2">&quot;~/&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find a default download directory&quot;</span><span class="p">)</span>

        <span class="c1"># append &quot;nltk_data&quot; to the home directory</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">homedir</span><span class="p">,</span> <span class="s2">&quot;nltk_data&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_download_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The default directory to which packages will be downloaded.</span>
<span class="sd">        This defaults to the value returned by ``default_download_dir()``.</span>
<span class="sd">        To override this default on a case-by-case basis, use the</span>
<span class="sd">        ``download_dir`` argument when calling ``download()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span>

    <span class="k">def</span> <span class="nf">_set_download_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>
        <span class="c1"># Clear the status cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">download_dir</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_download_dir</span><span class="p">,</span> <span class="n">_set_download_dir</span><span class="p">)</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Interactive Shell</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_interactive_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Try the GUI first; if that doesn&#39;t work, try the simple</span>
        <span class="c1"># interactive shell.</span>
        <span class="k">if</span> <span class="n">TKINTER</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">DownloaderGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">TclError</span><span class="p">:</span>
                <span class="n">DownloaderShell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DownloaderShell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<div class="viewcode-block" id="DownloaderShell"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderShell">[docs]</a><span class="k">class</span> <span class="nc">DownloaderShell</span><span class="p">:</span>
<div class="viewcode-block" id="DownloaderShell.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderShell.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataserver</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span> <span class="o">=</span> <span class="n">dataserver</span></div>

    <span class="k">def</span> <span class="nf">_simple_interactive_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">75</span><span class="p">)</span>
        <span class="n">spc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">68</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">options</span><span class="p">))</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="n">spc</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">75</span><span class="p">)</span>

<div class="viewcode-block" id="DownloaderShell.run"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderShell.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NLTK Downloader&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_menu</span><span class="p">(</span>
                <span class="s2">&quot;d) Download&quot;</span><span class="p">,</span>
                <span class="s2">&quot;l) List&quot;</span><span class="p">,</span>
                <span class="s2">&quot; u) Update&quot;</span><span class="p">,</span>
                <span class="s2">&quot;c) Config&quot;</span><span class="p">,</span>
                <span class="s2">&quot;h) Help&quot;</span><span class="p">,</span>
                <span class="s2">&quot;q) Quit&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Downloader&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_input</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">more_prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_help</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_config</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">):</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_download</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_update</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Command </span><span class="si">%r</span><span class="s2"> unrecognized&quot;</span> <span class="o">%</span> <span class="n">user_input</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error reading from server: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error connecting to server: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
            <span class="c1"># try checking if user_input is a package name, &amp;</span>
            <span class="c1"># downloading it?</span>
            <span class="nb">print</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_simple_interactive_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;    &quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download which package (l=list; x=cancel)?&quot;</span><span class="p">)</span>
                <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;  Identifier&gt; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">,</span>
                        <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">more_prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">skip_installed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">user_input</span><span class="p">:</span>
                    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;    &quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="k">def</span> <span class="nf">_simple_interactive_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">stale_packages</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stale</span> <span class="o">=</span> <span class="n">partial</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="p">,</span> <span class="s2">&quot;packages&quot;</span><span class="p">)(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span>
                    <span class="n">stale_packages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">info</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stale_packages</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Will update following packages (o=ok; x=cancel)&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">stale_packages</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">27</span> <span class="o">+</span> <span class="p">(</span><span class="n">pname</span><span class="p">),</span> <span class="mi">75</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="mi">27</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
                    <span class="p">)[</span><span class="mi">27</span><span class="p">:]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [ ] </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pid</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="n">name</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">()</span>

                <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;  Identifier&gt; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;o&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">stale_packages</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;    &quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to update.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_simple_interactive_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commands:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;  d) Download a package or collection     u) Update out of date packages&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  l) List packages &amp; collections          h) Help&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  c) View &amp; Modify Configuration          q) Quit&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Server:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - URL: &lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - </span><span class="si">%d</span><span class="s2"> Package Collections Available&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">collections</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - </span><span class="si">%d</span><span class="s2"> Individual Packages Available&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">packages</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Local Machine:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Data directory: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_simple_interactive_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_config</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simple_interactive_menu</span><span class="p">(</span>
                <span class="s2">&quot;s) Show Config&quot;</span><span class="p">,</span> <span class="s2">&quot;u) Set Server URL&quot;</span><span class="p">,</span> <span class="s2">&quot;d) Set Data Dir&quot;</span><span class="p">,</span> <span class="s2">&quot;m) Main Menu&quot;</span>
            <span class="p">)</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Config&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_config</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="n">new_dl_dir</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;  New Directory&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">new_dl_dir</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Cancelled!&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">new_dl_dir</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">new_dl_dir</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory </span><span class="si">%r</span><span class="s2"> not found!  Create it first.&quot;</span> <span class="o">%</span> <span class="n">new_dl_dir</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
                <span class="n">new_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;  New URL&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">new_url</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Cancelled!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">)):</span>
                        <span class="n">new_url</span> <span class="o">=</span> <span class="s2">&quot;http://&quot;</span> <span class="o">+</span> <span class="n">new_url</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">new_url</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading &lt;</span><span class="si">{</span><span class="n">new_url</span><span class="si">!r}</span><span class="s2">&gt;:</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="DownloaderGUI"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI">[docs]</a><span class="k">class</span> <span class="nc">DownloaderGUI</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Graphical interface for downloading packages from the NLTK data</span>
<span class="sd">    server.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Column Configuration</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Identifier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Unzipped Size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Copyright&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Contact&quot;</span><span class="p">,</span>
        <span class="s2">&quot;License&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Author&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Subdir&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Checksum&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;A list of the names of columns.  This controls the order in</span>
<span class="sd">       which the columns will appear.  If this is edited, then</span>
<span class="sd">       ``_package_to_columns()`` may need to be edited to match.&quot;&quot;&quot;</span>

    <span class="n">COLUMN_WEIGHTS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;A dictionary specifying how columns should be resized when the</span>
<span class="sd">       table is resized.  Columns with weight 0 will not be resized at</span>
<span class="sd">       all; and columns with high weight will be resized more.</span>
<span class="sd">       Default weight (for columns not explicitly listed) is 1.&quot;&quot;&quot;</span>

    <span class="n">COLUMN_WIDTHS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Identifier&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
        <span class="s2">&quot;Size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;Unzipped Size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;A dictionary specifying how wide each column should be, in</span>
<span class="sd">       characters.  The default width (for columns not explicitly</span>
<span class="sd">       listed) is specified by ``DEFAULT_COLUMN_WIDTH``.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_COLUMN_WIDTH</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="sd">&quot;&quot;&quot;The default width for columns that are not explicitly listed</span>
<span class="sd">       in ``COLUMN_WIDTHS``.&quot;&quot;&quot;</span>

    <span class="n">INITIAL_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;The set of columns that should be displayed by default.&quot;&quot;&quot;</span>

    <span class="c1"># Perform a few import-time sanity checks to make sure that the</span>
    <span class="c1"># column configuration variables are defined consistently:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COLUMN_WEIGHTS</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COLUMNS</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COLUMN_WIDTHS</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COLUMNS</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">INITIAL_COLUMNS</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COLUMNS</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Color Configuration</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">_BACKDROP_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="s2">&quot;#ccc&quot;</span><span class="p">)</span>

    <span class="n">_ROW_COLOR</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Downloader</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#afa&quot;</span><span class="p">,</span> <span class="s2">&quot;#080&quot;</span><span class="p">),</span>
        <span class="n">Downloader</span><span class="o">.</span><span class="n">PARTIAL</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#ffa&quot;</span><span class="p">,</span> <span class="s2">&quot;#880&quot;</span><span class="p">),</span>
        <span class="n">Downloader</span><span class="o">.</span><span class="n">STALE</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#faa&quot;</span><span class="p">,</span> <span class="s2">&quot;#800&quot;</span><span class="p">),</span>
        <span class="n">Downloader</span><span class="o">.</span><span class="n">NOT_INSTALLED</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#fff&quot;</span><span class="p">,</span> <span class="s2">&quot;#888&quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">_MARK_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="s2">&quot;#ccc&quot;</span><span class="p">)</span>

    <span class="c1"># _FRONT_TAB_COLOR = (&#39;#ccf&#39;, &#39;#008&#39;)</span>
    <span class="c1"># _BACK_TAB_COLOR = (&#39;#88a&#39;, &#39;#448&#39;)</span>
    <span class="n">_FRONT_TAB_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#fff&quot;</span><span class="p">,</span> <span class="s2">&quot;#45c&quot;</span><span class="p">)</span>
    <span class="n">_BACK_TAB_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#aaa&quot;</span><span class="p">,</span> <span class="s2">&quot;#67a&quot;</span><span class="p">)</span>

    <span class="n">_PROGRESS_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#f00&quot;</span><span class="p">,</span> <span class="s2">&quot;#aaa&quot;</span><span class="p">)</span>

    <span class="n">_TAB_FONT</span> <span class="o">=</span> <span class="s2">&quot;helvetica -16 bold&quot;</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Constructor</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="DownloaderGUI.__init__"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataserver</span><span class="p">,</span> <span class="n">use_threads</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span> <span class="o">=</span> <span class="n">dataserver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_threads</span> <span class="o">=</span> <span class="n">use_threads</span>

        <span class="c1"># For the threaded downloader:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># For tkinter after callbacks:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># A message log.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;NLTK Downloader Started!&quot;</span><span class="p">)</span>

        <span class="c1"># Create the main window.</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="p">()</span>
        <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;+50+50&quot;</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NLTK Downloader&quot;</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACKDROP_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Set up some bindings now, in case anything goes wrong.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-q&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-x&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_column_vars</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Initialize the GUI.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_widgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_menu</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_columns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Make sure we get notified when we&#39;re destroyed, so we can</span>
        <span class="c1"># cancel any download in progress.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Destroy&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroy</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(),</span> <span class="s2">&quot; | &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Internals</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_init_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create the top-level frame structures</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">sid</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># spacer</span>
        <span class="n">tabframe</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">tabframe</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)</span>
        <span class="n">tableframe</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">tableframe</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)</span>
        <span class="n">buttonframe</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">buttonframe</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)</span>
        <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># spacer</span>
        <span class="n">infoframe</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">infoframe</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)</span>
        <span class="n">Frame</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># spacer</span>
        <span class="n">progressframe</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACKDROP_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">progressframe</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="s2">&quot;border&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="s2">&quot;highlightthickness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Create the tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Collections&quot;</span><span class="p">,</span> <span class="s2">&quot;Corpora&quot;</span><span class="p">,</span> <span class="s2">&quot;Models&quot;</span><span class="p">,</span> <span class="s2">&quot;All Packages&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tabs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">tabframe</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">tab</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_TAB_FONT</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_tab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tabs</span><span class="p">[</span><span class="n">tab</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="c1"># Create the table.</span>
        <span class="n">column_weights</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">COLUMN_WEIGHTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLUMNS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
            <span class="n">tableframe</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">COLUMNS</span><span class="p">,</span>
            <span class="n">column_weights</span><span class="o">=</span><span class="n">column_weights</span><span class="p">,</span>
            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">listbox_height</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
            <span class="n">reprfunc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_reprfunc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">columnconfig</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MARK_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># marked</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COLUMNS</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLUMN_WIDTHS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_COLUMN_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">columnconfig</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">focus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind_to_listboxes</span><span class="p">(</span><span class="s2">&quot;&lt;Double-Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;space&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_mark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Left&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_tab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Right&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_tab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-a&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_all</span><span class="p">)</span>

        <span class="c1"># Create entry boxes for URL &amp; download_dir</span>
        <span class="n">infoframe</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;Server Index:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_url</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;download_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;Download Directory:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_download_dir</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">callback</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
            <span class="n">Label</span><span class="p">(</span><span class="n">infoframe</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span>
                <span class="n">infoframe</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="s2">&quot;courier&quot;</span><span class="p">,</span>
                <span class="n">relief</span><span class="o">=</span><span class="s2">&quot;groove&quot;</span><span class="p">,</span>
                <span class="n">disabledforeground</span><span class="o">=</span><span class="s2">&quot;#007aff&quot;</span><span class="p">,</span>
                <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;#007aff&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_save</span><span class="p">)</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_edit</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;ew&quot;</span><span class="p">)</span>

        <span class="c1"># If the user edits url or download_dir, and then clicks outside</span>
        <span class="c1"># the entry box, then save their results.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_save</span><span class="p">)</span>

        <span class="c1"># Create Download &amp; Refresh buttons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
            <span class="n">buttonframe</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Download&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_download</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
            <span class="n">buttonframe</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Refresh&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

        <span class="c1"># Create Progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progresslabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span>
            <span class="n">progressframe</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">foreground</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACKDROP_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACKDROP_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progressbar</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span>
            <span class="n">progressframe</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
            <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_PROGRESS_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">,</span>
            <span class="n">border</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_progressbar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progressbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progresslabel</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

        <span class="n">filemenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Download&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_download</span><span class="p">,</span> <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;Return&quot;</span>
        <span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Change Server Index&quot;</span><span class="p">,</span>
            <span class="n">underline</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_edit</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Change Download Directory&quot;</span><span class="p">,</span>
            <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_edit</span><span class="p">(</span><span class="s2">&quot;download_dir&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Show Log&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_log</span><span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">,</span> <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;Ctrl-x&quot;</span>
        <span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">filemenu</span><span class="p">)</span>

        <span class="c1"># Create a menu to control which columns of the table are</span>
        <span class="c1"># shown.  n.b.: we never hide the first two columns (mark and</span>
        <span class="c1"># identifier).</span>
        <span class="n">viewmenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_vars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_vars</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITIAL_COLUMNS</span><span class="p">:</span>
                <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">viewmenu</span><span class="o">.</span><span class="n">add_checkbutton</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_columns</span>
            <span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">viewmenu</span><span class="p">)</span>

        <span class="c1"># Create a sort menu</span>
        <span class="c1"># [xx] this should be selectbuttons; and it should include</span>
        <span class="c1"># reversed sorts as options.</span>
        <span class="n">sortmenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">sortmenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sort by </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="o">=</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;ascending&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="n">sortmenu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="c1"># sortmenu.add_command(label=&#39;Descending Sort:&#39;)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">sortmenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reverse sort by </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="o">=</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;descending&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sort&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">sortmenu</span><span class="p">)</span>

        <span class="n">helpmenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">helpmenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">about</span><span class="p">)</span>
        <span class="n">helpmenu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Instructions&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">,</span> <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;F1&quot;</span>
        <span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">helpmenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;F1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">menubar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_select_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">show_column</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">hide_column</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">clear_status_cache</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_info_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info_save</span><span class="p">()</span>  <span class="c1"># just in case.</span>
        <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">info_key</span><span class="p">]</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;relief&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sunken&quot;</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">focus</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_info_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">widget</span> <span class="ow">is</span> <span class="n">entry</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">keysym</span> <span class="o">!=</span> <span class="s2">&quot;Return&quot;</span><span class="p">:</span>
                <span class="n">focus</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;disabled&quot;</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;relief&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;groove&quot;</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">focus</span><span class="o">.</span><span class="n">focus</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_table_reprfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;  </span><span class="si">%.1f</span><span class="s2"> KB&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="o">**</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;  </span><span class="si">%.1f</span><span class="s2"> MB&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;  </span><span class="si">%.1f</span><span class="s2"> GB&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_set_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error Setting Server Index&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_info</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_download_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">==</span> <span class="n">download_dir</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># check if the dir exists, and if not, ask if we should create it?</span>

        <span class="c1"># Clear our status cache, &amp; re-check what&#39;s installed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_info</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_show_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;showing info&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="s2">&quot;download_dir&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;disabled&quot;</span>

    <span class="k">def</span> <span class="nf">_prev_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_next_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tabs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_names</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_select_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_table</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error reading from server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error connecting to server&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>

    <span class="n">_tab</span> <span class="o">=</span> <span class="s2">&quot;collections&quot;</span>
    <span class="c1"># _tab = &#39;corpora&#39;</span>
    <span class="n">_rows</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_fill_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">selected_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">==</span> <span class="s2">&quot;all packages&quot;</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">packages</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">==</span> <span class="s2">&quot;corpora&quot;</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">corpora</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">==</span> <span class="s2">&quot;models&quot;</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">models</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span> <span class="o">==</span> <span class="s2">&quot;collections&quot;</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">collections</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;bad tab value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_package_to_columns</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

        <span class="c1"># Highlight the active tab.</span>
        <span class="k">for</span> <span class="n">tab</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tabs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tab</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span><span class="p">:</span>
                <span class="n">label</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
                    <span class="n">foreground</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_FRONT_TAB_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_FRONT_TAB_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
                    <span class="n">foreground</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACK_TAB_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BACK_TAB_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="s2">&quot;Identifier&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;ascending&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_color_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selected_row</span><span class="p">)</span>

        <span class="c1"># This is a hack, because the scrollbar isn&#39;t updating its</span>
        <span class="c1"># position right -- I&#39;m not sure what the underlying cause is</span>
        <span class="c1"># though.  (This is on OS X w/ python 2.5)  The length of</span>
        <span class="c1"># delay that&#39;s necessary seems to depend on how fast the</span>
        <span class="c1"># comptuer is. :-/</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">_mlb</span><span class="o">.</span><span class="n">yview</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">_mlb</span><span class="o">.</span><span class="n">yview</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_update_table_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row_num</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row_num</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_color_table</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="c1"># If we&#39;re using threads, then delegate to the threaded</span>
        <span class="c1"># downloader instead.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_threads</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_threaded</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>

        <span class="n">marked</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">]</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">selected_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">marked</span> <span class="ow">and</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]]</span>

        <span class="n">download_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">incr_download</span><span class="p">(</span><span class="n">marked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_cb</span><span class="p">(</span><span class="n">download_iter</span><span class="p">,</span> <span class="n">marked</span><span class="p">)</span>

    <span class="n">_DL_DELAY</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">_download_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_iter</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">download_iter</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="c1"># self._fill_table(sort=False)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_table_status</span><span class="p">()</span>
            <span class="n">afterid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="p">[</span><span class="s2">&quot;_download_cb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afterid</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progresslabel</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ProgressMessage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># halt progress.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartCollectionMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Downloading collection </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartPackageMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Downloading package </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">UpToDateMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%s</span><span class="s2"> is up-to-date!&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># elif isinstance(msg, StaleMessage):</span>
        <span class="c1">#    show(&#39;Package %s is out-of-date or corrupt&#39; % msg.package.id)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishDownloadMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Finished downloading </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartUnzipMessage</span><span class="p">):</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Unzipping </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishCollectionMessage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Finished downloading collection </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_mark</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishPackageMessage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_mark</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">afterid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DL_DELAY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_cb</span><span class="p">,</span> <span class="n">download_iter</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="p">[</span><span class="s2">&quot;_download_cb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afterid</span>

    <span class="k">def</span> <span class="nf">_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_color_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Color rows according to status.</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)):</span>
            <span class="n">bg</span><span class="p">,</span> <span class="n">sbg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROW_COLOR</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">]]</span>
            <span class="n">fg</span><span class="p">,</span> <span class="n">sfg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">rowconfig</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span>
                <span class="n">foreground</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span>
                <span class="n">selectforeground</span><span class="o">=</span><span class="n">sfg</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
                <span class="n">selectbackground</span><span class="o">=</span><span class="n">sbg</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Color the marked column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">itemconfigure</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MARK_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MARK_COLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clear_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_mark_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>

    <span class="k">def</span> <span class="nf">_table_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">selected_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">selection</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_messages</span><span class="p">)</span>
        <span class="n">ShowText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="s2">&quot;NLTK Downloader Log&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_package_to_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a package, return a list of values describing that</span>
<span class="sd">        package, one for each column in ``self.COLUMNS``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COLUMNS</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">column_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Mark:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">column_name</span> <span class="o">==</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">column_name</span> <span class="o">==</span> <span class="s2">&quot;Status&quot;</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">pkg</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">column_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="s2">&quot;n/a&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># External Interface</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

<div class="viewcode-block" id="DownloaderGUI.destroy"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">afterid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after_cancel</span><span class="p">(</span><span class="n">afterid</span><span class="p">)</span>

        <span class="c1"># Abort any download in progress.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_threads</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_abort_download</span><span class="p">()</span>

        <span class="c1"># Make sure the garbage collector destroys these now;</span>
        <span class="c1"># otherwise, they may get destroyed when we&#39;re not in the main</span>
        <span class="c1"># thread, which would make Tkinter unhappy.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_vars</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="DownloaderGUI.mainloop"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI.mainloop">[docs]</a>    <span class="k">def</span> <span class="nf">mainloop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">mainloop</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># HELP</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">HELP</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    This tool can be used to download a variety of corpora and models</span>
<span class="sd">    that can be used with NLTK.  Each corpus or model is distributed</span>
<span class="sd">    in a single zip file, known as a \&quot;package file.\&quot;  You can</span>
<span class="sd">    download packages individually, or you can download pre-defined</span>
<span class="sd">    collections of packages.</span>

<span class="sd">    When you download a package, it will be saved to the \&quot;download</span>
<span class="sd">    directory.\&quot;  A default download directory is chosen when you run</span>

<span class="sd">    the downloader; but you may also select a different download</span>
<span class="sd">    directory.  On Windows, the default download directory is</span>


<span class="sd">    \&quot;package.\&quot;</span>

<span class="sd">    The NLTK downloader can be used to download a variety of corpora,</span>
<span class="sd">    models, and other data packages.</span>

<span class="sd">    Keyboard shortcuts::</span>
<span class="sd">      [return]\t Download</span>
<span class="sd">      [up]\t Select previous package</span>
<span class="sd">      [down]\t Select next package</span>
<span class="sd">      [left]\t Select previous tab</span>
<span class="sd">      [right]\t Select next tab</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="DownloaderGUI.help"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="c1"># The default font&#39;s not very legible; try using &#39;fixed&#39; instead.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ShowText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
                <span class="s2">&quot;Help: NLTK Downloader&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">HELP</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ShowText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="s2">&quot;Help: NLTK Downloader&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HELP</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span></div>

<div class="viewcode-block" id="DownloaderGUI.about"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.DownloaderGUI.about">[docs]</a>    <span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="n">ABOUT</span> <span class="o">=</span> <span class="s2">&quot;NLTK Downloader</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Written by Edward Loper&quot;</span>
        <span class="n">TITLE</span> <span class="o">=</span> <span class="s2">&quot;About: NLTK Downloader&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tkinter.messagebox</span> <span class="kn">import</span> <span class="n">Message</span>

            <span class="n">Message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ABOUT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">TITLE</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">ShowText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">TITLE</span><span class="p">,</span> <span class="n">ABOUT</span><span class="p">)</span></div>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Progress Bar</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="n">_gradient_width</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">_init_progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progressbar</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gradient_width</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gradient_width</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>
                <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gradient_width</span> <span class="o">-</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
                <span class="n">height</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gradient_width</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#</span><span class="si">%02x</span><span class="s2">0000&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">80</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">addtag_all</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>

        <span class="c1"># This is used to display progress</span>
        <span class="n">c</span><span class="o">.</span><span class="n">addtag_withtag</span><span class="p">(</span>
            <span class="s2">&quot;redbox&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_PROGRESS_COLOR</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progressbar</span>
        <span class="k">if</span> <span class="n">percent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="s2">&quot;redbox&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">percent</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">c</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="s2">&quot;redbox&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_progress_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progressbar</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">100</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gradient_width</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">afterid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_alive</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="p">[</span><span class="s2">&quot;_progress_alive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afterid</span>

    <span class="c1"># /////////////////////////////////////////////////////////////////</span>
    <span class="c1"># Threaded downloader</span>
    <span class="c1"># /////////////////////////////////////////////////////////////////</span>

    <span class="k">def</span> <span class="nf">_download_threaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="c1"># If the user tries to start a new download while we&#39;re already</span>
        <span class="c1"># downloading something, then abort the current download instead.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_abort_download</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Change the &#39;download&#39; button to an &#39;abort&#39; button.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_button</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cancel&quot;</span>

        <span class="n">marked</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">]</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">selected_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">marked</span> <span class="ow">and</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marked</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="s2">&quot;Identifier&quot;</span><span class="p">]]</span>

        <span class="c1"># Create a new data server object for the download operation,</span>
        <span class="c1"># just in case the user modifies our data server during the</span>
        <span class="c1"># download (e.g., clicking &#39;refresh&#39; or editing the index url).</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">download_dir</span><span class="p">)</span>

        <span class="c1"># Start downloading in a separate thread.</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DownloadThread</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">marked</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Monitor the download message queue &amp; display its progress.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_message_queue</span><span class="p">()</span>

        <span class="c1"># Display an indication that we&#39;re still alive and well by</span>
        <span class="c1"># cycling the progress bar.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_alive</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_abort_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;abort&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_DownloadThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_server</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">lock</span><span class="p">,</span> <span class="n">message_queue</span><span class="p">,</span> <span class="n">abort</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_server</span> <span class="o">=</span> <span class="n">data_server</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">lock</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span> <span class="o">=</span> <span class="n">message_queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span> <span class="o">=</span> <span class="n">abort</span>
            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_server</span><span class="o">.</span><span class="n">incr_download</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># Check if we&#39;ve been told to kill ourselves:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;aborted&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="n">_MONITOR_QUEUE_DELAY</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">_monitor_message_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progresslabel</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># Try to acquire the lock; if it&#39;s busy, then just try again later.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span><span class="p">:</span>

            <span class="c1"># Done downloading?</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;finished&quot;</span> <span class="ow">or</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;aborted&quot;</span><span class="p">:</span>
                <span class="c1"># self._fill_table(sort=False)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_table_status</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_button</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Download&quot;</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span><span class="p">[:]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span><span class="p">[:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;aborted&quot;</span><span class="p">:</span>
                    <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Download aborted!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">afterid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="p">[</span><span class="s2">&quot;_monitor_message_queue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afterid</span>
                <span class="k">return</span>

            <span class="c1"># All other messages</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ProgressMessage</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloading</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>  <span class="c1"># halt progress.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartCollectionMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Downloading collection </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartPackageMessage</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">clear_status_cache</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Downloading package </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">UpToDateMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%s</span><span class="s2"> is up-to-date!&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># elif isinstance(msg, StaleMessage):</span>
            <span class="c1">#    show(&#39;Package %s is out-of-date or corrupt; updating it&#39; %</span>
            <span class="c1">#         msg.package.id)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishDownloadMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Finished downloading </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">StartUnzipMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Unzipping </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishUnzipMessage</span><span class="p">):</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Finished installing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishCollectionMessage</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_indent</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">show</span><span class="p">(</span><span class="s2">&quot;Finished downloading collection </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_mark</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">FinishPackageMessage</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_table_status</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_mark</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="c1"># Let the user know when we&#39;re aborting a download (but</span>
        <span class="c1"># waiting for a good point to abort it, so we don&#39;t end up</span>
        <span class="c1"># with a partially unzipped package or anything like that).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_abort_queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progresslabel</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Aborting download...&quot;</span>

        <span class="c1"># Clear the message queue and then release the lock</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_msg_queue</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="c1"># Check the queue again after MONITOR_QUEUE_DELAY msec.</span>
        <span class="n">afterid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MONITOR_QUEUE_DELAY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_message_queue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_afterid</span><span class="p">[</span><span class="s2">&quot;_monitor_message_queue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afterid</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Helper Functions</span>
<span class="c1">######################################################################</span>
<span class="c1"># [xx] It may make sense to move these to nltk.internals.</span>


<div class="viewcode-block" id="md5_hexdigest"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.md5_hexdigest">[docs]</a><span class="k">def</span> <span class="nf">md5_hexdigest</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate and return the MD5 checksum for a given file.</span>
<span class="sd">    ``file`` may either be a filename or an open stream.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_md5_hexdigest</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_md5_hexdigest</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_md5_hexdigest</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="n">md5_digest</span> <span class="o">=</span> <span class="n">md5</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># 16k blocks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">md5_digest</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">md5_digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="c1"># change this to periodically yield progress messages?</span>
<span class="c1"># [xx] get rid of topdir parameter -- we should be checking</span>
<span class="c1"># this when we build the index, anyway.</span>
<div class="viewcode-block" id="unzip"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.unzip">[docs]</a><span class="k">def</span> <span class="nf">unzip</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the contents of the zip file ``filename`` into the</span>
<span class="sd">    directory ``root``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">_unzip_iter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_unzip_iter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Unzipping </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">ErrorMessage</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;Error with downloaded zip file&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">ErrorMessage</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>


<span class="c1">######################################################################</span>
<span class="c1"># Index Builder</span>
<span class="c1">######################################################################</span>
<span class="c1"># This may move to a different file sometime.</span>


<div class="viewcode-block" id="build_index"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.build_index">[docs]</a><span class="k">def</span> <span class="nf">build_index</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new data.xml index file, by combining the xml description</span>
<span class="sd">    files for various packages and collections.  ``root`` should be the</span>
<span class="sd">    path to a directory containing the package xml and zip files; and</span>
<span class="sd">    the collection xml files.  The ``root`` directory is expected to</span>
<span class="sd">    have the following subdirectories::</span>

<span class="sd">      root/</span>
<span class="sd">        packages/ .................. subdirectory for packages</span>
<span class="sd">          corpora/ ................. zip &amp; xml files for corpora</span>
<span class="sd">          grammars/ ................ zip &amp; xml files for grammars</span>
<span class="sd">          taggers/ ................. zip &amp; xml files for taggers</span>
<span class="sd">          tokenizers/ .............. zip &amp; xml files for tokenizers</span>
<span class="sd">          etc.</span>
<span class="sd">        collections/ ............... xml files for collections</span>

<span class="sd">    For each package, there should be two files: ``package.zip``</span>
<span class="sd">    (where *package* is the package name)</span>
<span class="sd">    which contains the package itself as a compressed zip file; and</span>
<span class="sd">    ``package.xml``, which is an xml description of the package.  The</span>
<span class="sd">    zipfile ``package.zip`` should expand to a single subdirectory</span>
<span class="sd">    named ``package/``.  The base filename ``package`` must match</span>
<span class="sd">    the identifier given in the package&#39;s xml file.</span>

<span class="sd">    For each collection, there should be a single file ``collection.zip``</span>
<span class="sd">    describing the collection, where *collection* is the name of the collection.</span>

<span class="sd">    All identifiers (for both packages and collections) must be unique.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find all packages.</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pkg_xml</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">_find_packages</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;packages&quot;</span><span class="p">)):</span>
        <span class="n">zipstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">subdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">unzipped_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">zf_info</span><span class="o">.</span><span class="n">file_size</span> <span class="k">for</span> <span class="n">zf_info</span> <span class="ow">in</span> <span class="n">zf</span><span class="o">.</span><span class="n">infolist</span><span class="p">())</span>

        <span class="c1"># Fill in several fields of the package xml with calculated values.</span>
        <span class="n">pkg_xml</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;unzipped_size&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">unzipped_size</span><span class="p">)</span>
        <span class="n">pkg_xml</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">zipstat</span><span class="o">.</span><span class="n">st_size</span><span class="p">)</span>
        <span class="n">pkg_xml</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;checksum&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">md5_hexdigest</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">pkg_xml</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subdir&quot;</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
        <span class="c1"># pkg_xml.set(&#39;svn_revision&#39;, _svn_revision(zf.filename))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pkg_xml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">):</span>
            <span class="n">pkg_xml</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Record the package.</span>
        <span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg_xml</span><span class="p">)</span>

    <span class="c1"># Find all collections</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_find_collections</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;collections&quot;</span><span class="p">)))</span>

    <span class="c1"># Check that all UIDs are unique</span>
    <span class="n">uids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">packages</span> <span class="o">+</span> <span class="n">collections</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate UID: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
        <span class="n">uids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>

    <span class="c1"># Put it all together</span>
    <span class="n">top_elt</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;nltk_data&quot;</span><span class="p">)</span>
    <span class="n">top_elt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;packages&quot;</span><span class="p">))</span>
    <span class="n">top_elt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">package</span><span class="p">:</span> <span class="n">package</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)))</span>
    <span class="n">top_elt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;collections&quot;</span><span class="p">))</span>
    <span class="n">top_elt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">collection</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)))</span>

    <span class="n">_indent_xml</span><span class="p">(</span><span class="n">top_elt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">top_elt</span></div>


<span class="k">def</span> <span class="nf">_indent_xml</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for ``build_index()``: Given an XML ``ElementTree``, modify it</span>
<span class="sd">    (and its descendents) ``text`` and ``tail`` attributes to generate</span>
<span class="sd">    an indented tree, where each nested element is indented by 2</span>
<span class="sd">    spaces with respect to its parent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xml</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">:</span>
            <span class="n">_indent_xml</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>
        <span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">prefix</span>


<span class="k">def</span> <span class="nf">_check_package</span><span class="p">(</span><span class="n">pkg_xml</span><span class="p">,</span> <span class="n">zipfilename</span><span class="p">,</span> <span class="n">zf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for ``build_index()``: Perform some checks to make sure that</span>
<span class="sd">    the given package is consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The filename must patch the id given in the XML file.</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">zipfilename</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pkg_xml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">uid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;package identifier mismatch (</span><span class="si">{}</span><span class="s2"> vs </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg_xml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">uid</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Zip file must expand to a subdir whose name matches uid.</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">((</span><span class="n">name</span> <span class="o">!=</span> <span class="n">uid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Zipfile </span><span class="si">%s</span><span class="s2">.zip does not expand to a single &quot;</span>
            <span class="s2">&quot;subdirectory </span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
        <span class="p">)</span>


<span class="c1"># update for git?</span>
<span class="k">def</span> <span class="nf">_svn_revision</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for ``build_index()``: Calculate the subversion revision</span>
<span class="sd">    number for a given file (by using ``subprocess`` to run ``svn``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;svn&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">stderr</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">stdout</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Error determining svn_revision for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_find_collections</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for ``build_index()``: Yield a list of ElementTree.Element</span>
<span class="sd">    objects, each holding the xml for a single package collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">_subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">):</span>
                <span class="n">xmlfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_find_packages</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for ``build_index()``: Yield a list of tuples</span>
<span class="sd">    ``(pkg_xml, zf, subdir)``, where:</span>
<span class="sd">      - ``pkg_xml`` is an ``ElementTree.Element`` holding the xml for a</span>
<span class="sd">        package</span>
<span class="sd">      - ``zf`` is a ``zipfile.ZipFile`` for the package&#39;s contents.</span>
<span class="sd">      - ``subdir`` is the subdirectory (relative to ``root``) where</span>
<span class="sd">        the package was found (e.g. &#39;corpora&#39; or &#39;grammars&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus.reader.util</span> <span class="kn">import</span> <span class="n">_path_from</span>

    <span class="c1"># Find all packages.</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="n">relpath</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_path_from</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirname</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">):</span>
                <span class="n">xmlfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">zipfilename</span> <span class="o">=</span> <span class="n">xmlfilename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zipfilename</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading file </span><span class="si">{</span><span class="n">zipfilename</span><span class="si">!r}</span><span class="s2">!</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pkg_xml</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xmlfilename</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading file </span><span class="si">{</span><span class="n">xmlfilename</span><span class="si">!r}</span><span class="s2">!</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

                <span class="c1"># Check that the UID matches the filename</span>
                <span class="n">uid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">xmlfilename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pkg_xml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">uid</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;package identifier mismatch (</span><span class="si">%s</span><span class="s2"> &quot;</span>
                        <span class="s2">&quot;vs </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pkg_xml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">uid</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># Check that the zipfile expands to a subdir whose</span>
                <span class="c1"># name matches the uid.</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">name</span> <span class="o">!=</span> <span class="n">uid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Zipfile </span><span class="si">%s</span><span class="s2">.zip does not expand to a &quot;</span>
                        <span class="s2">&quot;single subdirectory </span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">yield</span> <span class="n">pkg_xml</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">relpath</span>

            <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
                <span class="c1"># Warn user in case a .xml does not exist for a .zip</span>
                <span class="n">resourcename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xmlfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">resourcename</span> <span class="o">+</span> <span class="s2">&quot;.xml&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xmlfilename</span><span class="p">):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> exists, but </span><span class="si">{</span><span class="n">resourcename</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="si">}</span><span class="s2"> cannot be found! &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;This could mean that </span><span class="si">{</span><span class="n">resourcename</span><span class="si">}</span><span class="s2"> can not be downloaded.&quot;</span><span class="p">,</span>
                        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Don&#39;t recurse into svn subdirectories:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subdirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;.svn&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="c1">######################################################################</span>
<span class="c1"># Main:</span>
<span class="c1">######################################################################</span>

<span class="c1"># There should be a command-line interface</span>

<span class="c1"># Aliases</span>
<span class="n">_downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">()</span>
<span class="n">download</span> <span class="o">=</span> <span class="n">_downloader</span><span class="o">.</span><span class="n">download</span>


<div class="viewcode-block" id="download_shell"><a class="viewcode-back" href="../../api/nltk.downloader.download_shell.html#nltk.downloader.download_shell">[docs]</a><span class="k">def</span> <span class="nf">download_shell</span><span class="p">():</span>
    <span class="n">DownloaderShell</span><span class="p">(</span><span class="n">_downloader</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<div class="viewcode-block" id="download_gui"><a class="viewcode-back" href="../../api/nltk.downloader.download_gui.html#nltk.downloader.download_gui">[docs]</a><span class="k">def</span> <span class="nf">download_gui</span><span class="p">():</span>
    <span class="n">DownloaderGUI</span><span class="p">(</span><span class="n">_downloader</span><span class="p">)</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span></div>


<div class="viewcode-block" id="update"><a class="viewcode-back" href="../../api/nltk.downloader.html#nltk.downloader.update">[docs]</a><span class="k">def</span> <span class="nf">update</span><span class="p">():</span>
    <span class="n">_downloader</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--dir&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dir&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;download package to directory DIR&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;quiet&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;work quietly&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--force&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;download even if already installed&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-e&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--exit-on-error&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;halt_on_error&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;exit if an error occurs&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-u&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--url&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;server_index_url&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NLTK_DOWNLOAD_URL&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;download server index url&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">(</span><span class="n">server_index_url</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">server_index_url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pkg_id</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
                <span class="n">info_or_id</span><span class="o">=</span><span class="n">pkg_id</span><span class="p">,</span>
                <span class="n">download_dir</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span>
                <span class="n">quiet</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
                <span class="n">force</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                <span class="n">halt_on_error</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">halt_on_error</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">rv</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">halt_on_error</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
            <span class="n">download_dir</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span>
            <span class="n">quiet</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
            <span class="n">force</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
            <span class="n">halt_on_error</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">halt_on_error</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

        </div>
      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            

            
                <li class="footer-element">
                    <a href="https://github.com/nltk/nltk/tree/3.8.1">3.8.1</a>
                </li>
            

            
                <li class="footer-element">
                    Jan 02, 2023
                </li>
            
        </ul>

        
            <div id="copyright">
                &copy; 2023, NLTK Project
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/tomaarsen/nltk_theme">NLTK Theme</a>
        </div>
    </div>
</footer> 

</div>

</body>
</html>
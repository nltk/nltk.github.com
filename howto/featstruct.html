<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>NLTK :: Sample usage for featstruct</title>
  

  <link rel="stylesheet" href="../_static/css/nltk_theme.css"/>
  <link rel="stylesheet" href="../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="nltk-theme-container">
    <header>
      <div id="logo-container">
          
          <h1>
            <a href="../index.html">NLTK</a>
          </h1>
          
      </div>
      <div id="project-container">
        
        <h1>Documentation</h1>
        
      </div>

      <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

      <script type="text/javascript">
        $("#menu-toggle").click(function() {
          $("#menu-toggle").toggleClass("toggled");
          $("#side-menu-container").slideToggle(300);
        });
      </script>
    </header>

    <div id="content-container">

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">
          
  
    
  
  
    <p class="caption" role="heading"><span class="caption-text">NLTK Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/nltk.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../howto.html">Example Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki">Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki/FAQ">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/issues">Open Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk">NLTK on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">Installing NLTK Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../news.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html">NLTK Team</a></li>
</ul>

  

        </div>

        
      </div>

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <section id="sample-usage-for-featstruct">
<h1>Sample usage for featstruct<a class="headerlink" href="#sample-usage-for-featstruct" title="Permalink to this heading">¶</a></h1>
<section id="feature-structures-unification">
<h2>Feature Structures &amp; Unification<a class="headerlink" href="#feature-structures-unification" title="Permalink to this heading">¶</a></h2>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">FeatStruct</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.sem.logic</span> <span class="kn">import</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">VariableExpression</span><span class="p">,</span> <span class="n">Expression</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For now, featstruct uses the older lambdalogic semantics
module.  Eventually, it should be updated to use the new first
order predicate logic module.</p>
</div>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h3>
<p>A feature structure is a mapping from feature identifiers to feature
values, where feature values can be simple values (like strings or
ints), nested feature structures, or variables:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;singular&#39;</span><span class="p">,</span> <span class="n">person</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="p">)</span>
<span class="go">[ number = &#39;singular&#39; ]</span>
<span class="go">[ person = 3          ]</span>
</pre></div>
</div>
<p>Feature structure may be nested:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="n">agr</span><span class="o">=</span><span class="n">fs1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[ agr  = [ number = &#39;singular&#39; ] ]</span>
<span class="go">[        [ person = 3          ] ]</span>
<span class="go">[                                ]</span>
<span class="go">[ type = &#39;NP&#39;                    ]</span>
</pre></div>
</div>
<p>Variables are used to indicate that two features should be assigned
the same value.  For example, the following feature structure requires
that the feature fs3[‘agr’][‘number’] be bound to the same value as the
feature fs3[‘subj’][‘number’].</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">agr</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?n&#39;</span><span class="p">)),</span>
<span class="gp">... </span>                 <span class="n">subj</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?n&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs3</span><span class="p">)</span>
<span class="go">[ agr  = [ number = ?n ] ]</span>
<span class="go">[                        ]</span>
<span class="go">[ subj = [ number = ?n ] ]</span>
</pre></div>
</div>
<p>Feature structures are typically used to represent partial information
about objects.  A feature name that is not mapped to a value stands
for a feature whose value is unknown (<em>not</em> a feature without a
value).  Two feature structures that represent (potentially
overlapping) information about the same object can be combined by
<em>unification</em>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs3</span><span class="p">))</span>
<span class="go">[ agr  = [ number = &#39;singular&#39; ] ]</span>
<span class="go">[        [ person = 3          ] ]</span>
<span class="go">[                                ]</span>
<span class="go">[ subj = [ number = &#39;singular&#39; ] ]</span>
<span class="go">[                                ]</span>
<span class="go">[ type = &#39;NP&#39;                    ]</span>
</pre></div>
</div>
<p>When two inconsistent feature structures are unified, the unification
fails and returns <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs4</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">agr</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs4</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">))</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs4</span><span class="p">))</span>
<span class="go">None</span>
</pre></div>
</div>
<section id="feature-structure-types">
<h4>Feature Structure Types<a class="headerlink" href="#feature-structure-types" title="Permalink to this heading">¶</a></h4>
<p>There are actually two types of feature structure:</p>
<ul class="simple">
<li><p><em>feature dictionaries</em>, implemented by <cite>FeatDict</cite>, act like
Python dictionaries.  Feature identifiers may be strings or
instances of the <cite>Feature</cite> class.</p></li>
<li><p><em>feature lists</em>, implemented by <cite>FeatList</cite>, act like Python
lists.  Feature identifiers are integers.</p></li>
</ul>
<p>When you construct a feature structure using the <cite>FeatStruct</cite>
constructor, it will automatically decide which type is appropriate:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;singular&#39;</span><span class="p">))</span>
<span class="go">&lt;class &#39;nltk.featstruct.FeatDict&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="go">&lt;class &#39;nltk.featstruct.FeatList&#39;&gt;</span>
</pre></div>
</div>
<p>Usually, we will just use feature dictionaries; but sometimes feature
lists can be useful too.  Two feature lists will unify with each other
only if they have equal lengths, and all of their feature values
match.  If you wish to write a feature list that contains ‘unknown’
values, you must use variables:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?y&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">),</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
</section>
<section id="parsing-feature-structure-strings">
<h4>Parsing Feature Structure Strings<a class="headerlink" href="#parsing-feature-structure-strings" title="Permalink to this heading">¶</a></h4>
<p>Feature structures can be constructed directly from strings.  Often,
this is more convenient than constructing them directly.  NLTK can
parse most feature strings to produce the corresponding feature
structures.  (But you must restrict your base feature values to
strings, ints, logic expressions (<cite>nltk.sem.logic.Expression</cite>), and a
few other types discussed below).</p>
<p>Feature dictionaries are written like Python dictionaries, except that
keys are not put in quotes; and square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) are used
instead of braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[tense=&quot;past&quot;, agr=[number=&quot;sing&quot;, person=3]]&#39;</span><span class="p">)</span>
<span class="go">[agr=[number=&#39;sing&#39;, person=3], tense=&#39;past&#39;]</span>
</pre></div>
</div>
<p>If a feature value is a single alphanumeric word, then it does not
need to be quoted – it will be automatically treated as a string:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[tense=past, agr=[number=sing, person=3]]&#39;</span><span class="p">)</span>
<span class="go">[agr=[number=&#39;sing&#39;, person=3], tense=&#39;past&#39;]</span>
</pre></div>
</div>
<p>Feature lists are written like python lists:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[1, 2, 3]&#39;</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">[]</span></code> is treated as an empty feature dictionary, not
an empty feature list:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">))</span>
<span class="go">&lt;class &#39;nltk.featstruct.FeatDict&#39;&gt;</span>
</pre></div>
</div>
</section>
<section id="feature-paths">
<h4>Feature Paths<a class="headerlink" href="#feature-paths" title="Permalink to this heading">¶</a></h4>
<p>Features can be specified using <em>feature paths</em>, or tuples of feature
identifiers that specify path through the nested feature structures to
a value.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=1, y=[1,2,[z=3]]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="go">[1, 2, [z=3]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="go">[z=3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="go">3</span>
</pre></div>
</div>
</section>
<section id="reentrance">
<h4>Reentrance<a class="headerlink" href="#reentrance" title="Permalink to this heading">¶</a></h4>
<p>Feature structures may contain reentrant feature values.  A <em>reentrant
feature value</em> is a single feature structure that can be accessed via
multiple feature paths.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">fs1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[ a = (1) [ x = &#39;val&#39; ] ]</span>
<span class="go">[                       ]</span>
<span class="go">[ b -&gt; (1)              ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[a=(1)[x=&#39;val&#39;], b-&gt;(1)]</span>
</pre></div>
</div>
<p>As you can see, reentrane is displayed by marking a feature structure
with a unique identifier, in this case <code class="docutils literal notranslate"><span class="pre">(1)</span></code>, the first time it is
encountered; and then using the special form <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">-&gt;</span> <span class="pre">id</span></code> whenever it
is encountered again.  You can use the same notation to directly
create reentrant feature structures from strings.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[], b-&gt;(1), c=[d-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="go">[a=(1)[], b-&gt;(1), c=[d-&gt;(1)]]</span>
</pre></div>
</div>
<p>Reentrant feature structures may contain cycles:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[a-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">(1)[a-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Unification preserves the reentrance relations imposed by both of the
unified feature structures.  In the feature structure resulting from
unification, any modifications to a reentrant feature value will be
visible using any of its feature paths.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[b=12], c=33]&#39;</span><span class="p">))</span>
<span class="go">(1)[a-&gt;(1), b=12, c=33]</span>
</pre></div>
</div>
</section>
<section id="feature-structure-equality">
<h4>Feature Structure Equality<a class="headerlink" href="#feature-structure-equality" title="Permalink to this heading">¶</a></h4>
<p>Two feature structures are considered equal if they assign the same
values to all features, <em>and</em> they contain the same reentrances.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[x=1], b-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[x=1], b-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[x=1], b=[x=1]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">==</span> <span class="n">fs1</span><span class="p">,</span> <span class="n">fs1</span> <span class="ow">is</span> <span class="n">fs1</span>
<span class="go">(True, True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">==</span> <span class="n">fs2</span><span class="p">,</span> <span class="n">fs1</span> <span class="ow">is</span> <span class="n">fs2</span>
<span class="go">(True, False)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">==</span> <span class="n">fs3</span><span class="p">,</span> <span class="n">fs1</span> <span class="ow">is</span> <span class="n">fs3</span>
<span class="go">(False, False)</span>
</pre></div>
</div>
<p>Note that this differs from how Python dictionaries and lists define
equality – in particular, Python dictionaries and lists ignore
reentrance relations.  To test two feature structures for equality
while ignoring reentrance relations, use the <cite>equal_values()</cite> method:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">fs1</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">fs3</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="feature-value-sets-feature-value-tuples">
<h4>Feature Value Sets &amp; Feature Value Tuples<a class="headerlink" href="#feature-value-sets-feature-value-tuples" title="Permalink to this heading">¶</a></h4>
<p><cite>nltk.featstruct</cite> defines two new data types that are intended to be
used as feature values: <cite>FeatureValueTuple</cite> and <cite>FeatureValueSet</cite>.
Both of these types are considered base values – i.e., unification
does <em>not</em> apply to them.  However, variable binding <em>does</em> apply to
any values that they contain.</p>
<p>Feature value tuples are written with parentheses:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(?x, ?y)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[x=(?x, ?y)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">substitute_bindings</span><span class="p">({</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?y&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">})</span>
<span class="go">[x=(1, 2)]</span>
</pre></div>
</div>
<p>Feature sets are written with braces:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x={?x, ?y}]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[x={?x, ?y}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">substitute_bindings</span><span class="p">({</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?y&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">})</span>
<span class="go">[x={1, 2}]</span>
</pre></div>
</div>
<p>In addition to the basic feature value tuple &amp; set classes, nltk
defines feature value unions (for sets) and feature value
concatenations (for tuples).  These are written using ‘+’, and can be
used to combine sets &amp; tuples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=((1, 2)+?z), z=?z]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[x=((1, 2)+?z), z=?z]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[z=(3, 4, 5)]&#39;</span><span class="p">))</span>
<span class="go">[x=(1, 2, 3, 4, 5), z=(3, 4, 5)]</span>
</pre></div>
</div>
<p>Thus, feature value tuples and sets can be used to build up tuples
and sets of values over the course of unification.  For example, when
parsing sentences using a semantic feature grammar, feature sets or
feature tuples can be used to build a list of semantic predicates as
the sentence is parsed.</p>
<p>As was mentioned above, unification does not apply to feature value
tuples and sets.  One reason for this that it’s impossible to define a
single correct answer for unification when concatenation is used.
Consider the following example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1, 2, 3, 4)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(?a+?b), a=?a, b=?b]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If unification applied to feature tuples, then the unification
algorithm would have to arbitrarily choose how to divide the tuple
(1,2,3,4) into two parts.  Instead, the unification algorithm refuses
to make this decision, and simply unifies based on value.  Because
(1,2,3,4) is not equal to (?a+?b), fs1 and fs2 will not unify:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">))</span>
<span class="go">None</span>
</pre></div>
</div>
<p>If you need a list-like structure that unification does apply to, use
<cite>FeatList</cite>.</p>
</section>
<section id="light-weight-feature-structures">
<h4>Light-weight Feature Structures<a class="headerlink" href="#light-weight-feature-structures" title="Permalink to this heading">¶</a></h4>
<p>Many of the functions defined by <cite>nltk.featstruct</cite> can be applied
directly to simple Python dictionaries and lists, rather than to
full-fledged <cite>FeatDict</cite> and <cite>FeatList</cite> objects.  In other words,
Python <code class="docutils literal notranslate"><span class="pre">dicts</span></code> and <code class="docutils literal notranslate"><span class="pre">lists</span></code> can be used as “light-weight” feature
structures.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note: pprint prints dicts sorted</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">unify</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">unify</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">()),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">))))</span>
<span class="go">{&#39;a&#39;: &#39;a&#39;, &#39;x&#39;: 1, &#39;y&#39;: {&#39;b&#39;: &#39;b&#39;}}</span>
</pre></div>
</div>
<p>However, you should keep in mind the following caveats:</p>
<ul class="simple">
<li><p>Python dictionaries &amp; lists ignore reentrance when checking for
equality between values.  But two FeatStructs with different
reentrances are considered nonequal, even if all their base
values are equal.</p></li>
<li><p>FeatStructs can be easily frozen, allowing them to be used as
keys in hash tables.  Python dictionaries and lists can not.</p></li>
<li><p>FeatStructs display reentrance in their string representations;
Python dictionaries and lists do not.</p></li>
<li><p>FeatStructs may <em>not</em> be mixed with Python dictionaries and lists
(e.g., when performing unification).</p></li>
<li><p>FeatStructs provide a number of useful methods, such as <cite>walk()</cite>
and <cite>cyclic()</cite>, which are not available for Python dicts &amp; lists.</p></li>
</ul>
<p>In general, if your feature structures will contain any reentrances,
or if you plan to use them as dictionary keys, it is strongly
recommended that you use full-fledged <cite>FeatStruct</cite> objects.</p>
</section>
<section id="custom-feature-values">
<h4>Custom Feature Values<a class="headerlink" href="#custom-feature-values" title="Permalink to this heading">¶</a></h4>
<p>The abstract base class <cite>CustomFeatureValue</cite> can be used to define new
base value types that have custom unification methods.  For example,
the following feature value type encodes a range, and defines
unification as taking the intersection on the ranges:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">total_ordering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">CustomFeatureValue</span><span class="p">,</span> <span class="n">UnificationFailure</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@total_ordering</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Range</span><span class="p">(</span><span class="n">CustomFeatureValue</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">assert</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">high</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">low</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">high</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">unify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Range</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">UnificationFailure</span>
<span class="gp">... </span>        <span class="n">low</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">high</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">UnificationFailure</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">&lt;x&lt;</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Range</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Range</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">True</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">22</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">22</span><span class="p">))))</span>
<span class="go">[ x = (6&lt;x&lt;8)          ]</span>
<span class="go">[                      ]</span>
<span class="go">[ y = [ z = (7&lt;x&lt;22) ] ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">))))</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">12</span><span class="p">)))</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=?x, y=[z=?x]]&#39;</span><span class="p">)))</span>
<span class="go">[ x = (7&lt;x&lt;8)         ]</span>
<span class="go">[                     ]</span>
<span class="go">[ y = [ z = (7&lt;x&lt;8) ] ]</span>
</pre></div>
</div>
</section>
</section>
<section id="regression-tests">
<h3>Regression Tests<a class="headerlink" href="#regression-tests" title="Permalink to this heading">¶</a></h3>
<section id="dictionary-access-methods-non-mutating">
<h4>Dictionary access methods (non-mutating)<a class="headerlink" href="#dictionary-access-methods-non-mutating" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Feature structures support all dictionary methods (excluding the class
method <cite>dict.fromkeys()</cite>).  Non-mutating methods:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>                               <span class="c1"># keys()</span>
<span class="go">[&#39;x&#39;, &#39;y&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>                             <span class="c1"># values()</span>
<span class="go">[[a=1, b=2, c=3], &#39;x&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>                              <span class="c1"># items()</span>
<span class="go">[(&#39;x&#39;, [a=1, b=2, c=3]), (&#39;y&#39;, &#39;x&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>                                      <span class="c1"># __iter__()</span>
<span class="go">[&#39;x&#39;, &#39;y&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">fs2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">fs2</span>                           <span class="c1"># __contains__()</span>
<span class="go">(False, True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>               <span class="c1"># has_key()</span>
<span class="go">(False, True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>                               <span class="c1"># __getitem__()</span>
<span class="go">([a=1, b=2, c=3], &#39;x&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>                                         <span class="c1"># __getitem__()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">KeyError</span>: <span class="n">&#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>         <span class="c1"># get()</span>
<span class="go">([a=1, b=2, c=3], &#39;x&#39;, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>     <span class="c1"># get()</span>
<span class="go">([a=1, b=2, c=3], &#39;hello&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">fs1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>                               <span class="c1"># __len__</span>
<span class="go">(3, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>                                       <span class="c1"># copy()</span>
<span class="go">[x=[a=1, b=2, c=3], y=&#39;x&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="ow">is</span> <span class="n">fs2</span>                                <span class="c1"># copy()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Note: by default, <cite>FeatStruct.copy()</cite> does a deep copy.  Use
<cite>FeatStruct.copy(deep=False)</cite> for a shallow copy.</p>
</section>
<section id="dictionary-access-methods-mutating">
<h4>Dictionary access methods (mutating)<a class="headerlink" href="#dictionary-access-methods-mutating" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Setting features (<cite>__setitem__()</cite>)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[a=1, b=2, c=5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[a=1, b=2, c=5, x=12]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[x=[a=2, b=2, c=5, x=12], y=&#39;x&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[a=2, b=2, c=5, x=12]</span>
</pre></div>
</div>
<p>Deleting features (<cite>__delitem__()</cite>)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[a=2, b=2, c=5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[b=2, c=5]</span>
</pre></div>
</div>
<p><cite>setdefault()</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[b=2, c=5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
<span class="go">99</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[b=2, c=5, x=99]</span>
</pre></div>
</div>
<p><cite>update()</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;B&#39;</span><span class="p">},</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[a=&#39;A&#39;, b=&#39;B&#39;, c=&#39;C&#39;, x=[b=2, c=5, x=99], y=&#39;x&#39;]</span>
</pre></div>
</div>
<p><cite>pop()</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[b=&#39;B&#39;, c=&#39;C&#39;, x=[b=2, c=5, x=99], y=&#39;x&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">KeyError</span>: <span class="n">&#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[b=&#39;B&#39;, c=&#39;C&#39;, x=[b=2, c=5, x=99], y=&#39;x&#39;]</span>
</pre></div>
</div>
<p><cite>clear()</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[b=&#39;B&#39;, c=&#39;C&#39;, x=[], y=&#39;x&#39;]</span>
</pre></div>
</div>
<p><cite>popitem()</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">([</span><span class="n">fs2</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs2</span><span class="p">))])</span>
<span class="go">[(&#39;b&#39;, &#39;B&#39;), (&#39;c&#39;, &#39;C&#39;), (&#39;x&#39;, []), (&#39;y&#39;, &#39;x&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>Once a feature structure has been frozen, it may not be mutated.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=1, y=2, z=[a=3]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Frozen FeatStructs may not be modified.</span>
</pre></div>
</div>
</section>
<section id="id1">
<h4>Feature Paths<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h4>
<p>Make sure that __getitem__ with feature paths works as intended:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                <span class="n">c</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">d</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="n">f</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[()]</span>
<span class="go">[a=1, b=2, c=[d=[e=12], f=[g=55, h=&#39;hello&#39;]]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">fs1</span><span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,)]</span>
<span class="go">(1, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="go">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
<span class="go">55</span>
</pre></div>
</div>
<p>Feature paths that select unknown features raise KeyError:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">KeyError</span>: <span class="n">(&#39;c&#39;, &#39;f&#39;, &#39;e&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">KeyError</span>: <span class="n">(&#39;q&#39;, &#39;p&#39;)</span>
</pre></div>
</div>
<p>Feature paths that try to go ‘through’ a feature that’s not a feature
structure raise KeyError:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">KeyError</span>: <span class="n">(&#39;a&#39;, &#39;b&#39;)</span>
</pre></div>
</div>
<p>Feature paths can go through reentrant structures:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[a=[b=[c-&gt;(1), d=5], e=11]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="go">11</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;abcabcabcabcabcabcabcabcabcabca&#39;</span><span class="p">)]</span>
<span class="go">(1)[b=[c=[a-&gt;(1)], d=5], e=11]</span>
</pre></div>
</div>
<p>Indexing requires strings, <cite>Feature</cite>s, or tuples; other types raise a
TypeError:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">TypeError</span>: <span class="n">Expected feature name or path.  Got 12.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">TypeError</span>: <span class="n">Expected feature name or path.  Got [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;].</span>
</pre></div>
</div>
<p>Feature paths can also be used with <cite>get()</cite>, <cite>has_key()</cite>, and
<cite>__contains__()</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fpath1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;abcabc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fpath2</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;abcabz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fpath1</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fpath2</span><span class="p">)</span>
<span class="go">((1)[a=[b=[c-&gt;(1), d=5], e=11]], None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fpath1</span> <span class="ow">in</span> <span class="n">fs2</span><span class="p">,</span> <span class="n">fpath2</span> <span class="ow">in</span> <span class="n">fs2</span>
<span class="go">(True, False)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">fpath1</span><span class="p">),</span> <span class="n">fs2</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">fpath2</span><span class="p">)</span>
<span class="go">(True, False)</span>
</pre></div>
</div>
</section>
<section id="reading-feature-structures">
<h4>Reading Feature Structures<a class="headerlink" href="#reading-feature-structures" title="Permalink to this heading">¶</a></h4>
<p>Empty feature struct:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>Test features with integer values:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=12, b=-33, c=0]&#39;</span><span class="p">)</span>
<span class="go">[a=12, b=-33, c=0]</span>
</pre></div>
</div>
<p>Test features with string values.  Either single or double quotes may
be used.  Strings are evaluated just like python strings – in
particular, you can use escape sequences and ‘u’ and ‘r’ prefixes, and
triple-quoted strings.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=&quot;&quot;, b=&quot;hello&quot;, c=&quot;</span><span class="se">\&#39;</span><span class="s1">&quot;, d=</span><span class="se">\&#39;\&#39;</span><span class="s1">, e=</span><span class="se">\&#39;</span><span class="s1">&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">)</span>
<span class="go">[a=&#39;&#39;, b=&#39;hello&#39;, c=&quot;&#39;&quot;, d=&#39;&#39;, e=&#39;&quot;&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a=&quot;</span><span class="se">\\</span><span class="s1">&quot;, b=&quot;\&quot;&quot;, c=&quot;\x6f</span><span class="se">\\</span><span class="s1">y&quot;, d=&quot;12&quot;]&#39;</span><span class="p">)</span>
<span class="go">[a=&#39;\\&#39;, b=&#39;&quot;&#39;, c=&#39;o\\y&#39;, d=&#39;12&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[b=r&quot;a\b\c&quot;]&#39;</span><span class="p">)</span>
<span class="go">[b=&#39;a\\b\\c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=&quot;&quot;&quot;a&quot;&quot;&quot;]&#39;</span><span class="p">)</span>
<span class="go">[x=&#39;a&#39;]</span>
</pre></div>
</div>
<p>Test parsing of reentrant feature structures.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[], b-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="go">[a=(1)[], b-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[x=1, y=2], b-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="go">[a=(1)[x=1, y=2], b-&gt;(1)]</span>
</pre></div>
</div>
<p>Test parsing of cyclic feature structures.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[b-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="go">[a=(1)[b-&gt;(1)]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[a=[b=[c-&gt;(1)]]]&#39;</span><span class="p">)</span>
<span class="go">(1)[a=[b=[c-&gt;(1)]]]</span>
</pre></div>
</div>
<p>Strings of the form “+name” and “-name” may be used to specify boolean
values.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[-bar, +baz, +foo]&#39;</span><span class="p">)</span>
<span class="go">[-bar, +baz, +foo]</span>
</pre></div>
</div>
<p>None, True, and False are recognized as values:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[bar=True, baz=False, foo=None]&#39;</span><span class="p">)</span>
<span class="go">[+bar, -baz, foo=None]</span>
</pre></div>
</div>
<p>Special features:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;NP/VP&#39;</span><span class="p">)</span>
<span class="go">NP[]/VP[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;?x/?x&#39;</span><span class="p">)</span>
<span class="go">?x[]/?x[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;VP[+fin, agr=?x, tense=past]/NP[+pl, agr=?x]&#39;</span><span class="p">))</span>
<span class="go">[ *type*  = &#39;VP&#39;              ]</span>
<span class="go">[                             ]</span>
<span class="go">[           [ *type* = &#39;NP&#39; ] ]</span>
<span class="go">[ *slash* = [ agr    = ?x   ] ]</span>
<span class="go">[           [ pl     = True ] ]</span>
<span class="go">[                             ]</span>
<span class="go">[ agr     = ?x                ]</span>
<span class="go">[ fin     = True              ]</span>
<span class="go">[ tense   = &#39;past&#39;            ]</span>
</pre></div>
</div>
<p>Here the slash feature gets coerced:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[*slash*=a, x=b, *type*=&quot;NP&quot;]&#39;</span><span class="p">)</span>
<span class="go">NP[x=&#39;b&#39;]/a[]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;NP[sem=&lt;bob&gt;]/NP&#39;</span><span class="p">)</span>
<span class="go">NP[sem=&lt;bob&gt;]/NP[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;S[sem=&lt;walk(bob)&gt;]&#39;</span><span class="p">)</span>
<span class="go">S[sem=&lt;walk(bob)&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;NP[sem=&lt;bob&gt;]/NP&#39;</span><span class="p">))</span>
<span class="go">[ *type*  = &#39;NP&#39;              ]</span>
<span class="go">[                             ]</span>
<span class="go">[ *slash* = [ *type* = &#39;NP&#39; ] ]</span>
<span class="go">[                             ]</span>
<span class="go">[ sem     = &lt;bob&gt;             ]</span>
</pre></div>
</div>
<p>Playing with ranges:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">RangeFeature</span><span class="p">,</span> <span class="n">FeatStructReader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">width</span> <span class="o">=</span> <span class="n">RangeFeature</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FeatStructReader</span><span class="p">([</span><span class="n">width</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;[*width*=-5:12]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;[*width*=2:123]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;[*width*=-7:-2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[*width*=(2, 12)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs3</span><span class="p">)</span>
<span class="go">[*width*=(-5, -2)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs3</span><span class="p">))</span> <span class="c1"># no overlap in width.</span>
<span class="go">None</span>
</pre></div>
</div>
<p>The slash feature has a default value of ‘False’:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;NP[]/VP&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;NP[]&#39;</span><span class="p">),</span> <span class="n">trace</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="go">Unification trace:</span>
<span class="go">   / NP[]/VP[]</span>
<span class="go">  |\ NP[]</span>
<span class="go">  |</span>
<span class="go">  | Unify feature: *type*</span>
<span class="go">  |    / &#39;NP&#39;</span>
<span class="go">  |   |\ &#39;NP&#39;</span>
<span class="go">  |   |</span>
<span class="go">  |   +--&gt;&#39;NP&#39;</span>
<span class="go">  |</span>
<span class="go">  | Unify feature: *slash*</span>
<span class="go">  |    / VP[]</span>
<span class="go">  |   |\ False</span>
<span class="go">  |   |</span>
<span class="go">  X   X &lt;-- FAIL</span>
<span class="go">None</span>
</pre></div>
</div>
<p>The demo structures from category.py.  They all parse, but they don’t
do quite the right thing, – ?x vs x.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">agr</span><span class="o">=</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;pl&#39;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>
<span class="go">[agr=[gender=&#39;f&#39;, number=&#39;pl&#39;], pos=&#39;n&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;NP[sem=&lt;bob&gt;]/NP&#39;</span><span class="p">)</span>
<span class="go">NP[sem=&lt;bob&gt;]/NP[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;S[sem=&lt;app(?x, ?y)&gt;]&#39;</span><span class="p">)</span>
<span class="go">S[sem=&lt;?x(?y)&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;?x/?x&#39;</span><span class="p">)</span>
<span class="go">?x[]/?x[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;VP[+fin, agr=?x, tense=past]/NP[+pl, agr=?x]&#39;</span><span class="p">)</span>
<span class="go">VP[agr=?x, +fin, tense=&#39;past&#39;]/NP[agr=?x, +pl]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;S[sem = &lt;app(?subj, ?vp)&gt;]&#39;</span><span class="p">)</span>
<span class="go">S[sem=&lt;?subj(?vp)&gt;]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
<span class="go">S[]</span>
</pre></div>
</div>
<p>The parser also includes support for reading sets and tuples.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x={1,2,2,2}, y={/}]&#39;</span><span class="p">)</span>
<span class="go">[x={1, 2}, y={/}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1,2,2,2), y=()]&#39;</span><span class="p">)</span>
<span class="go">[x=(1, 2, 2, 2), y=()]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1,[z=(1,2,?x)],?z,{/})]&#39;</span><span class="p">))</span>
<span class="go">[ x = (1, [ z = (1, 2, ?x) ], ?z, {/}) ]</span>
</pre></div>
</div>
<p>Note that we can’t put a featstruct inside a tuple, because doing so
would hash it, and it’s not frozen yet:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x={[]}]&#39;</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">TypeError</span>: <span class="n">FeatStructs must be frozen before they can be hashed.</span>
</pre></div>
</div>
<p>There’s a special syntax for taking the union of sets: “{…+…}”.
The elements should only be variables or sets.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x={?a+?b+{1,2,3}}]&#39;</span><span class="p">)</span>
<span class="go">[x={?a+?b+{1, 2, 3}}]</span>
</pre></div>
</div>
<p>There’s a special syntax for taking the concatenation of tuples:
“(…+…)”.  The elements should only be variables or tuples.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(?a+?b+(1,2,3))]&#39;</span><span class="p">)</span>
<span class="go">[x=(?a+?b+(1, 2, 3))]</span>
</pre></div>
</div>
<p>Parsing gives helpful messages if your string contains an error.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=, b=5]]&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    [a=, b=5]]</span>
<span class="go">       ^ Expected value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=12 22, b=33]&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    [a=12 22, b=33]</span>
<span class="go">         ^ Expected comma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=5] [b=6]&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    [a=5] [b=6]</span>
<span class="go">          ^ Expected end of string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39; *++*&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    *++*</span>
<span class="go">    ^ Expected open bracket or identifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    [x-&gt;(1)]</span>
<span class="go">        ^ Expected bound identifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x-&gt;y]&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>
<span class="go">    [x-&gt;y]</span>
<span class="go">        ^ Expected identifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Error parsing feature structure</span>

<span class="go">    ^ Expected open bracket or identifier</span>
</pre></div>
</div>
</section>
<section id="unification">
<h4>Unification<a class="headerlink" href="#unification" title="Permalink to this heading">¶</a></h4>
<p>Very simple unifications give the expected results:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">()</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">())</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;singular&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">())</span>
<span class="go">[number=&#39;singular&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">()</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;singular&#39;</span><span class="p">))</span>
<span class="go">[number=&#39;singular&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="s1">&#39;singular&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="go">[number=&#39;singular&#39;, person=3]</span>
</pre></div>
</div>
<p>Merging nested structures:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[A=[B=b]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[A=[C=c]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[A=[B=&#39;b&#39;, C=&#39;c&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs1</span><span class="p">)</span>
<span class="go">[A=[B=&#39;b&#39;, C=&#39;c&#39;]]</span>
</pre></div>
</div>
<p>A basic case of reentrant unification</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs4</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[A=(1)[B=b], E=[F-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs5</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[A=[C=&#39;c&#39;], E=[F=[D=&#39;d&#39;]]]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs4</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs5</span><span class="p">)</span>
<span class="go">[A=(1)[B=&#39;b&#39;, C=&#39;c&#39;, D=&#39;d&#39;], E=[F-&gt;(1)]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs5</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs4</span><span class="p">)</span>
<span class="go">[A=(1)[B=&#39;b&#39;, C=&#39;c&#39;, D=&#39;d&#39;], E=[F-&gt;(1)]]</span>
</pre></div>
</div>
<p>More than 2 paths to a value</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[a=[],b=[],c=[],d=[]]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[], b-&gt;(1), c-&gt;(1), d-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[a=(1)[], b-&gt;(1), c-&gt;(1), d-&gt;(1)]</span>
</pre></div>
</div>
<p>fs1[a] gets unified with itself</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1)[], y-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1)[], y-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[x=(1)[], y-&gt;(1)]</span>
</pre></div>
</div>
<p>Bound variables should get forwarded appropriately</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[A=(1)[X=x], B-&gt;(1), C=?cvar, D=?dvar]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[A=(1)[Y=y], B=(2)[Z=z], C-&gt;(1), D-&gt;(2)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[A=(1)[X=&#39;x&#39;, Y=&#39;y&#39;, Z=&#39;z&#39;], B-&gt;(1), C-&gt;(1), D-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs1</span><span class="p">)</span>
<span class="go">[A=(1)[X=&#39;x&#39;, Y=&#39;y&#39;, Z=&#39;z&#39;], B-&gt;(1), C-&gt;(1), D-&gt;(1)]</span>
</pre></div>
</div>
<p>Cyclic structure created by unification.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[F=(1)[], G-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[F=[H=(2)[]], G-&gt;(2)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span>
<span class="go">[F=(1)[H-&gt;(1)], G-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Cyclic structure created w/ variables.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[F=[H=?x]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[F=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">rename_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span>
<span class="go">[F=(1)[H-&gt;(1)]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">fs3</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Unifying w/ a cyclic feature structure.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs4</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[F=[H=[H=[H=(1)[]]]], K-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs4</span><span class="p">)</span>
<span class="go">[F=(1)[H-&gt;(1)], K-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs4</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs3</span><span class="p">)</span>
<span class="go">[F=(1)[H-&gt;(1)], K-&gt;(1)]</span>
</pre></div>
</div>
<p>Variable bindings should preserve reentrance.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[a=?x]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[a=[]]&quot;</span><span class="p">),</span> <span class="n">bindings</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">bindings</span><span class="p">[</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">)]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[b=?x]&quot;</span><span class="p">),</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=(1)[], b-&gt;(1)]</span>
</pre></div>
</div>
<p>Aliased variable tests</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[a=?x, b=?x]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[b=?y, c=?y]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span>
<span class="go">[a=?x, b=?x, c=?x]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span>
<span class="go">{Variable(&#39;?y&#39;): Variable(&#39;?x&#39;)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s2">&quot;[a=1]&quot;</span><span class="p">))</span>
<span class="go">[a=1, b=1, c=1]</span>
</pre></div>
</div>
<p>If we keep track of the bindings, then we can use the same variable
over multiple calls to unify.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[]]&#39;</span><span class="p">),</span> <span class="n">bindings</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[b=?x]&#39;</span><span class="p">),</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=(1)[], b-&gt;(1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span>
<span class="go">{Variable(&#39;?x&#39;): []}</span>
</pre></div>
</div>
</section>
<section id="unification-bindings">
<h4>Unification Bindings<a class="headerlink" href="#unification-bindings" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=12]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[b=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=12]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span>
<span class="go">{Variable(&#39;?x&#39;): 12}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span><span class="o">.</span><span class="n">substitute_bindings</span><span class="p">(</span><span class="n">bindings</span><span class="p">)</span>
<span class="go">[b=12]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="c1"># substitute_bindings didn&#39;t mutate fs3.</span>
<span class="go">[b=?x]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs3</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=12, b=12]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=1]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=5, b=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=5, b=1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">bindings</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(Variable(&#39;?x&#39;), 5), (Variable(&#39;?x2&#39;), 1)]</span>
</pre></div>
</div>
</section>
<section id="expressions">
<h4>Expressions<a class="headerlink" href="#expressions" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">Expression</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">P y.P(z,y)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">VariableExpression</span><span class="p">(</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[x=&lt;\P y.P(John,y)&gt;, y=&lt;John&gt;]</span>
</pre></div>
</div>
</section>
<section id="remove-variables">
<h4>Remove Variables<a class="headerlink" href="#remove-variables" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=12, c=[d=?y]]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">remove_variables</span><span class="p">()</span>
<span class="go">[b=12, c=[]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[a=[b=?x,c-&gt;(1)]]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">remove_variables</span><span class="p">()</span>
<span class="go">(1)[a=[c-&gt;(1)]]</span>
</pre></div>
</div>
</section>
<section id="equality-hashing">
<h4>Equality &amp; Hashing<a class="headerlink" href="#equality-hashing" title="Permalink to this heading">¶</a></h4>
<p>The <cite>equal_values</cite> method checks whether two feature structures assign
the same value to every feature.  If the optional argument
<code class="docutils literal notranslate"><span class="pre">check_reentrances</span></code> is supplied, then it also returns false if there
is any difference in the reentrances.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[x-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[x-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[x=[x-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[x=(1)[x-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;(1)[x=[x-&gt;(1), y=1], y=1]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;equal values, same reentrance&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">equal_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;equal values, different reentrance&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;different values&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="go">equal values, same reentrance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="go">equal values, same reentrance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="go">equal values, different reentrance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="go">equal values, different reentrance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="go">equal values, different reentrance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="go">different values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="go">different values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="go">different values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="go">equal values, same reentrance</span>
</pre></div>
</div>
<p>Feature structures may not be hashed until they are frozen:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">hash</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">TypeError</span>: <span class="n">FeatStructs must be frozen before they can be hashed.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Feature structures define hash consistently.  The following example
looks at the hash value for each (fs1,fs2) pair; if their hash values
are not equal, then they must not be equal.  If their hash values are
equal, then display a message, and indicate whether their values are
indeed equal.  Note that c and d currently have the same hash value,
even though they are not equal.  That is not a bug, strictly speaking,
but it wouldn’t be a bad thing if it changed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">fstruct</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">fstruct</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">fs1_name</span> <span class="ow">in</span> <span class="s1">&#39;abcde&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">fs2_name</span> <span class="ow">in</span> <span class="s1">&#39;abcde&#39;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">fs1</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fs1_name</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">fs2</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fs2_name</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">fs1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">fs2</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">assert</span> <span class="n">fs1</span> <span class="o">!=</span> <span class="n">fs2</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1"> have the same hash value,&#39;</span> <span class="o">%</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="n">fs1_name</span><span class="p">,</span> <span class="n">fs2_name</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">fs1</span> <span class="o">==</span> <span class="n">fs2</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and are equal&#39;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and are not equal&#39;</span><span class="p">)</span>
<span class="go">a and a have the same hash value, and are equal</span>
<span class="go">a and b have the same hash value, and are equal</span>
<span class="go">b and a have the same hash value, and are equal</span>
<span class="go">b and b have the same hash value, and are equal</span>
<span class="go">c and c have the same hash value, and are equal</span>
<span class="go">c and d have the same hash value, and are not equal</span>
<span class="go">d and c have the same hash value, and are not equal</span>
<span class="go">d and d have the same hash value, and are equal</span>
<span class="go">e and e have the same hash value, and are equal</span>
</pre></div>
</div>
</section>
<section id="tracing">
<h4>Tracing<a class="headerlink" href="#tracing" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[b=(1)[], c=?x], d-&gt;(1), e=[f=?x]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[c=&quot;C&quot;], e=[g-&gt;(1)]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="go">Unification trace:</span>
<span class="go">   / [a=[b=(1)[], c=?x], d-&gt;(1), e=[f=?x]]</span>
<span class="go">  |\ [a=(1)[c=&#39;C&#39;], e=[g-&gt;(1)]]</span>
<span class="go">  |</span>
<span class="go">  | Unify feature: a</span>
<span class="go">  |    / [b=[], c=?x]</span>
<span class="go">  |   |\ [c=&#39;C&#39;]</span>
<span class="go">  |   |</span>
<span class="go">  |   | Unify feature: a.c</span>
<span class="go">  |   |    / ?x</span>
<span class="go">  |   |   |\ &#39;C&#39;</span>
<span class="go">  |   |   |</span>
<span class="go">  |   |   +--&gt;Variable(&#39;?x&#39;)</span>
<span class="go">  |   |</span>
<span class="go">  |   +--&gt;[b=[], c=?x]</span>
<span class="go">  |       Bindings: {?x: &#39;C&#39;}</span>
<span class="go">  |</span>
<span class="go">  | Unify feature: e</span>
<span class="go">  |    / [f=?x]</span>
<span class="go">  |   |\ [g=[c=&#39;C&#39;]]</span>
<span class="go">  |   |</span>
<span class="go">  |   +--&gt;[f=?x, g=[b=[], c=?x]]</span>
<span class="go">  |       Bindings: {?x: &#39;C&#39;}</span>
<span class="go">  |</span>
<span class="go">  +--&gt;[a=(1)[b=(2)[], c=&#39;C&#39;], d-&gt;(2), e=[f=&#39;C&#39;, g-&gt;(1)]]</span>
<span class="go">      Bindings: {?x: &#39;C&#39;}</span>
<span class="go">[a=(1)[b=(2)[], c=&#39;C&#39;], d-&gt;(2), e=[f=&#39;C&#39;, g-&gt;(1)]]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=?z, c=?z]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?y, b=?y, c=?q]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#fs1.unify(fs2, trace=True)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="unification-on-dicts-lists">
<h4>Unification on Dicts &amp; Lists<a class="headerlink" href="#unification-on-dicts-lists" title="Permalink to this heading">¶</a></h4>
<p>It’s possible to do unification on dictionaries:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">unify</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">unify</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">)),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">{&#39;q&#39;: 5, &#39;x&#39;: 1, &#39;y&#39;: {&#39;z&#39;: 2}}</span>
</pre></div>
</div>
<p>It’s possible to do unification on lists as well:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>Mixing dicts and lists is fine:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">unify</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="mi">3</span><span class="p">]),</span>
<span class="gp">... </span>              <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[{&#39;q&#39;: 5, &#39;x&#39;: 1, &#39;y&#39;: {&#39;z&#39;: 2}}, 3]</span>
</pre></div>
</div>
<p>Mixing dicts and FeatStructs is discouraged:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unify</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  . . .</span>
<span class="gr">ValueError</span>: <span class="n">Mixing FeatStruct objects with Python dicts and lists is not supported.</span>
</pre></div>
</div>
<p>But you can do it if you really want, by explicitly stating that both
dictionaries and FeatStructs should be treated as feature structures:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unify</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">fs_class</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FeatStruct</span><span class="p">))</span>
<span class="go">{&#39;x&#39;: 1}</span>
</pre></div>
</div>
</section>
<section id="finding-conflicts">
<h4>Finding Conflicts<a class="headerlink" href="#finding-conflicts" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">conflicts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[b=(1)[c=2], d-&gt;(1), e=[f-&gt;(1)]]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[b=[c=[x=5]], d=[c=2], e=[f=[c=3]]]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">(</span><span class="n">fs1</span><span class="p">,</span> <span class="n">fs2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">: </span><span class="si">%r</span><span class="s1"> vs </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">fs1</span><span class="p">[</span><span class="n">path</span><span class="p">],</span> <span class="n">fs2</span><span class="p">[</span><span class="n">path</span><span class="p">]))</span>
<span class="go">a.b.c   : 2 vs [x=5]</span>
<span class="go">a.e.f.c : 2 vs 3</span>
</pre></div>
</div>
</section>
<section id="retracting-bindings">
<h4>Retracting Bindings<a class="headerlink" href="#retracting-bindings" title="Permalink to this heading">¶</a></h4>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.featstruct</span> <span class="kn">import</span> <span class="n">retract_bindings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=[c=?y]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[c=[d=1]], b-&gt;(1)]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs3</span> <span class="o">=</span> <span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs3</span><span class="p">)</span>
<span class="go">[ a = (1) [ c = [ d = 1 ] ] ]</span>
<span class="go">[                           ]</span>
<span class="go">[ b -&gt; (1)                  ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">bindings</span><span class="p">)</span>
<span class="go">{Variable(&#39;?x&#39;): [c=[d=1]], Variable(&#39;?y&#39;): [d=1]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">retract_bindings</span><span class="p">(</span><span class="n">fs3</span><span class="p">,</span> <span class="n">bindings</span><span class="p">)</span>
<span class="go">[a=?x, b=?x]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">bindings</span><span class="p">)</span>
<span class="go">{Variable(&#39;?x&#39;): [c=?y], Variable(&#39;?y&#39;): [d=1]}</span>
</pre></div>
</div>
</section>
</section>
<section id="squashed-bugs">
<h3>Squashed Bugs<a class="headerlink" href="#squashed-bugs" title="Permalink to this heading">¶</a></h3>
<p>In svn rev 5167, unifying two feature structures that used the same
variable would cause those variables to become aliased in the output.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[b=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[a=?x, b=?x2]</span>
</pre></div>
</div>
<p>There was a bug in svn revision 5172 that caused <cite>rename_variables</cite> to
rename variables to names that are already used.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=?x2]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename_variables</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">)])</span>
<span class="go">[a=?x3, b=?x2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=?x, b=?x2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">)</span>
<span class="go">[a=?x, b=?x2]</span>
</pre></div>
</div>
<p>There was a bug in svn rev 5167 that caused us to get the following
example wrong.  Basically the problem was that we only followed
‘forward’ pointers for other, not self, when unifying two feature
structures.  (nb: this test assumes that features are unified in
alphabetical order – if they are not, it might pass even if the bug
is present.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs1</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=[x=1], b=?x, c=?x]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs2</span> <span class="o">=</span> <span class="n">FeatStruct</span><span class="p">(</span><span class="s1">&#39;[a=(1)[], b-&gt;(1), c=[x=2]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fs1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">fs2</span><span class="p">))</span>
<span class="go">None</span>
</pre></div>
</div>
</section>
</section>
</section>


        </div>
      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            
                <li class="footer-element">
                    
                        <a href="../_sources/howto/featstruct.rst.txt" rel="nofollow"> source</a>
                    
                </li>
            

            
                <li class="footer-element">
                    <a href="https://github.com/nltk/nltk/tree/3.8.1">3.8.1</a>
                </li>
            

            
                <li class="footer-element">
                    Jan 02, 2023
                </li>
            
        </ul>

        
            <div id="copyright">
                &copy; 2023, NLTK Project
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/tomaarsen/nltk_theme">NLTK Theme</a>
        </div>
    </div>
</footer> 

</div>

</body>
</html>